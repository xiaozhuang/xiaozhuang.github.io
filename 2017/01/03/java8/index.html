<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="“编程语言的某个新特性还会时不时地让我感到兴奋，因为它让我花更少的时间就能够写出更清晰、更简洁的代码。”————JAVA8实战">
<meta name="keywords" content="Java">
<meta property="og:type" content="article">
<meta property="og:title" content="Java 8">
<meta property="og:url" content="http://xiaozhuang.github.io/2017/01/03/java8/index.html">
<meta property="og:site_name" content="Communicat &amp; Happy Together">
<meta property="og:description" content="“编程语言的某个新特性还会时不时地让我感到兴奋，因为它让我花更少的时间就能够写出更清晰、更简洁的代码。”————JAVA8实战">
<meta property="og:updated_time" content="2019-08-03T05:23:22.550Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java 8">
<meta name="twitter:description" content="“编程语言的某个新特性还会时不时地让我感到兴奋，因为它让我花更少的时间就能够写出更清晰、更简洁的代码。”————JAVA8实战">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6286766081142949000,
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>




  <title> Java 8 | Communicat & Happy Together </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Communicat & Happy Together</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Java 8
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-01-03T19:29:53+08:00" content="2017-01-03">
              2017-01-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>“编程语言的某个新特性还会时不时地让我感到兴奋，因为它让我花更少的时间就能够写出更清晰、更简洁的代码。”<br>————JAVA8实战<br><a id="more"></a></p>
<h1 id="方法和Lambda作为一等公民"><a href="#方法和Lambda作为一等公民" class="headerlink" title="方法和Lambda作为一等公民"></a>方法和Lambda作为一等公民</h1><p>java8的第一个新功能是方法引用。</p>
<p>方法传递的形参是接口，实参是方法或Lambda</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Apple&gt; <span class="title">filterApples</span><span class="params">(List&lt;Apple&gt; inventory, Predicate&lt;Apple&gt; p)</span></span>&#123;</div><div class="line">	List&lt;Apple&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">	<span class="keyword">for</span>(Apple apple : inventory)&#123;</div><div class="line">		<span class="keyword">if</span>(p.test(apple))&#123;</div><div class="line">			result.add(apple);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isHeavyApple</span><span class="params">(Apple p)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> p.getWeight() &gt; <span class="number">150</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//库存</span></div><div class="line">List&lt;Apple&gt; inventory = Arrays.asList(<span class="keyword">new</span> Apple(<span class="number">80</span>,<span class="string">"green"</span>),</div><div class="line">        <span class="keyword">new</span> Apple(<span class="number">155</span>, <span class="string">"green"</span>),</div><div class="line">        <span class="keyword">new</span> Apple(<span class="number">120</span>, <span class="string">"red"</span>));</div><div class="line"></div><div class="line"></div><div class="line">List&lt;Apple&gt; filterApples = filterApples(inventory,(Apple a) -&gt; <span class="string">"green"</span>.equals(a.getColor()));</div><div class="line">System.out.println(filterApples);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 方法引用::语法</span></div><div class="line">List&lt;Apple&gt; filterApples2 = filterApples(inventory,App::isHeavyApple);</div><div class="line">System.out.println(filterApples2);</div></pre></td></tr></table></figure>
<h1 id="通过行为参数化传递代码"><a href="#通过行为参数化传递代码" class="headerlink" title="通过行为参数化传递代码"></a>通过行为参数化传递代码</h1><p><code>行为参数化</code></p>
<p>行为参数化，接受多个<code>不同的行为作为参数</code>，并在内部使用它们，完成不同的行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Apple apple)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Apple&gt; <span class="title">filterApples</span><span class="params">(List&lt;Apple&gt; apples, Predicate predicate)</span></span>&#123;</div><div class="line">    LinkedList&lt;Apple&gt; results = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (Apple apple : apples) &#123;</div><div class="line">        <span class="keyword">if</span>(predicate.test(apple))&#123;</div><div class="line">            results.add(apple);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> results;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>泛型化:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T apple)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">filterApples</span><span class="params">(List&lt;T&gt; list, Predicate&lt;T&gt; p)</span></span>&#123;</div><div class="line">    LinkedList&lt;T&gt; results = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (T e : list) &#123;</div><div class="line">        <span class="keyword">if</span>(p.test(e))&#123;</div><div class="line">            results.add(e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> results;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">filterApples(apples, (Apple apple) -&gt; <span class="string">"red"</span>.equals(apple.getColor()));</div><div class="line">filterApples(apples, (Apple apple) -&gt; apple.getWeight() &gt; <span class="number">150</span>);</div></pre></td></tr></table></figure>
<h1 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h1><p>Lambda 表达式可理解为简洁地表示<code>可传递</code>的<code>匿名函数</code>的一种方式。</p>
<ul>
<li>参数列表</li>
<li>函数主题</li>
<li>返回类型</li>
<li>异常列表</li>
</ul>
<p>基本语法：<br><code>(parameters) -&gt; expression</code></p>
<p><code>(parameters) -&gt; { statements; }</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Comparator&lt;Apple&gt; byWeight = (Apple a1, Apple a2) -&gt; ObjectUtils.compare(a1.getWeight(), a2.getWeight());</div><div class="line"></div><div class="line"><span class="comment">// 表达式可包含多行</span></div><div class="line"><span class="comment">/* (int x, int y) -&gt; &#123;</span></div><div class="line"> 	System.out.println("Result:");</div><div class="line">     System.out.println(x + y);</div><div class="line"> &#125;</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="comment">// 可使用显式返回语句</span></div><div class="line"><span class="comment">// return 是一个控制流，需使用花括号</span></div><div class="line"><span class="comment">// (Integer i) -&gt; &#123; return "Alan" + i; &#125;</span></div></pre></td></tr></table></figure>
<h2 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h2><p>函数式接口就是只定义一个抽象方法的接口</p>
<blockquote>
<p>包含<code>默认方法</code>时，只要接口只定义<code>一个抽象方法</code>，仍然是函数接口。</p>
</blockquote>
<p>Lambda表达式允许直接以<code>内联的形式</code>为函数是接口的抽象方法提供实现，<br>并把整个表达式作为函数式接口的实例。</p>
<p>Lambda表达式可以赋值给一个<code>变量</code> 或 传递给<code>接收函数式接口作为参数</code>的方法。</p>
<p>@FunctionalInterface 注解，表示该接口设计成一个函数式接口。</p>
<h2 id="环绕执行模式"><a href="#环绕执行模式" class="headerlink" title="环绕执行模式"></a>环绕执行模式</h2><p>资源处理时，打开资源，做一些处理，然后关闭资源；</p>
<p>使用Lambda表达式，传递行为，复用环绕执行代码；</p>
<h2 id="使用函数式接口"><a href="#使用函数式接口" class="headerlink" title="使用函数式接口"></a>使用函数式接口</h2><h3 id="Predicate"><a href="#Predicate" class="headerlink" title="Predicate"></a>Predicate</h3><p><code>java.util.function.Predicate&lt;T&gt;</code></p>
<p>Predicate定义<code>test</code>方法，接受泛型对象，并返回boolean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@FunctionalInterface</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><p><code>java.util.function.Consumer&lt;T&gt;</code></p>
<p>Consumer定义<code>accept</code>方法，接受泛型对象，返回void<br>访问T对象，并执行某些操作，可使用该接口；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@FunctionalInterface</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p><code>java.util.function.Function&lt;T, R&gt;</code></p>
<p>Function 定义apply方法，接受泛型T对象，返回泛型R对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@FunctionalInterface</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</div><div class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数接口汇总"><a href="#函数接口汇总" class="headerlink" title="函数接口汇总"></a>函数接口汇总</h3><table>
<thead>
<tr>
<th>接口</th>
<th>类型</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>Predicate<t></t></td>
<td>1入参</td>
<td>Boolean</td>
</tr>
<tr>
<td>BiPredicate<t, u=""></t,></td>
<td>2入参</td>
<td>Boolean</td>
</tr>
<tr>
<td>Supplier<t></t></td>
<td>无入参</td>
<td>T</td>
</tr>
<tr>
<td>Consumer<t></t></td>
<td>1入参</td>
<td>void</td>
</tr>
<tr>
<td>BiConsumer<t></t></td>
<td>2入参</td>
<td>void</td>
</tr>
<tr>
<td>Function<t, r=""></t,></td>
<td>1入参</td>
<td>R</td>
</tr>
<tr>
<td>BiFunction<t, u,="" r=""></t,></td>
<td>2入参</td>
<td>R</td>
</tr>
<tr>
<td>UnaryOperator<t></t></td>
<td>1入参T</td>
<td>T</td>
</tr>
<tr>
<td>BinaryOperator<t></t></td>
<td>1入参T</td>
<td>T</td>
</tr>
</tbody>
</table>
<h3 id="原始类型特化"><a href="#原始类型特化" class="headerlink" title="原始类型特化"></a>原始类型特化</h3><p>Predicate<integer> 使用基本数据类型时，会自动装箱；</integer></p>
<p>Jdk提供了函数式接口专门的版本，IntPredicate、LongPredicate等，避免自动装箱；</p>
<blockquote>
<p>装箱后的值需要更多的内存，并需要额外的内存搜索来获取被包装的原始值。</p>
</blockquote>
<h2 id="类型检查、类型推断以及限制"><a href="#类型检查、类型推断以及限制" class="headerlink" title="类型检查、类型推断以及限制"></a>类型检查、类型推断以及限制</h2><p>Lambda表达式可以为接口生成一个实例。</p>
<h3 id="类型检查"><a href="#类型检查" class="headerlink" title="类型检查"></a>类型检查</h3><p>Lambda的类型 从使用Lambda的上下文推断出来。 上下文中Lambda表达式需要的类型称为 <code>目标类型</code>。</p>
<p>Lambda表达式抛出异常，则抽象方法声明的throws语句也必须匹配。</p>
<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><p>Lambda可以没有限制的捕获<code>实例变量</code>和<code>静态变量</code>。</p>
<p>Lambda访问局部变量，实际是<code>访问局部变量的副本</code>。</p>
<h3 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">List&lt;Apple&gt; appleList = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">appleList.add(<span class="keyword">new</span> Apple(<span class="number">150</span>));</div><div class="line">appleList.add(<span class="keyword">new</span> Apple(<span class="number">100</span>));</div><div class="line"></div><div class="line"><span class="comment">// 升序</span></div><div class="line">appleList.sort(Comparator.comparing(Apple::getWeight));</div><div class="line"></div><div class="line"><span class="comment">// 降序</span></div><div class="line">appleList.sort(Comparator.comparing(Apple::getWeight).reversed());</div></pre></td></tr></table></figure>
<p>3种方法引用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1. 静态方法引用</span></div><div class="line">(args) -&gt; ClassName.staticMethod(args);</div><div class="line"></div><div class="line">ClassName::staticMethod</div><div class="line"></div><div class="line"><span class="comment">// 2. 实例方法引用 (arg0 为ClassName类型)</span></div><div class="line">(arg0, rest) -&gt; arg0.instanceMethod(rest)</div><div class="line">ClassNama::instanceMethod</div><div class="line"></div><div class="line"><span class="comment">// 3. 对象的实例方法引用</span></div><div class="line">(args) -&gt; expr.instanceMethod(args)</div><div class="line">expression::instanceMethod;</div></pre></td></tr></table></figure>
<h3 id="构造方法引用"><a href="#构造方法引用" class="headerlink" title="构造方法引用"></a>构造方法引用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 无参构造</span></div><div class="line">Supplier&lt;Apple&gt; c1 = Apple::<span class="keyword">new</span>;</div><div class="line">Apple apple = c1.get();</div><div class="line"></div><div class="line"><span class="comment">// 有参构造</span></div><div class="line">Function&lt;Integer, Apple&gt; c2 = Apple::<span class="keyword">new</span>;</div><div class="line">Apple apple150 = c2.apply(<span class="number">150</span>);</div></pre></td></tr></table></figure>
<h2 id="复合Lambda表达式"><a href="#复合Lambda表达式" class="headerlink" title="复合Lambda表达式"></a>复合Lambda表达式</h2><p>通过默认方法，实现函数接口复合</p>
<h3 id="比较器复合"><a href="#比较器复合" class="headerlink" title="比较器复合"></a>比较器复合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 逆序</span></div><div class="line">appleList.sort(Comparator.comparing(Apple::getWeight).reversed());</div><div class="line"></div><div class="line"><span class="comment">// 比较器链，第1个比较相等时，按第2个比较</span></div><div class="line">appleList.sort(Comparator.comparing(Apple::getWeight)</div><div class="line">                .reversed()</div><div class="line">                .thenComparing(Apple::getColor));</div><div class="line"></div><div class="line"><span class="comment">// org.apache.commons.lang3.ObjectUtils#compare(T, T)</span></div><div class="line"><span class="comment">// 升序排序，null在后面</span></div><div class="line">apples.sort((o1, o2) -&gt; ObjectUtils.compare(o1.getDate(), o2.getDate()));</div><div class="line">System.out.println(JSON.toJSONString(apples, SerializerFeature.WriteDateUseDateFormat));</div><div class="line"></div><div class="line"><span class="comment">// 升序排序，null在前面</span></div><div class="line">apples.sort((o1, o2) -&gt; ObjectUtils.compare(o1.getDate(), o2.getDate(), <span class="keyword">true</span>));</div><div class="line">System.out.println(JSON.toJSONString(apples, SerializerFeature.WriteDateUseDateFormat));</div><div class="line"></div><div class="line"><span class="comment">// 降序</span></div><div class="line">apples.sort(</div><div class="line">        Collections.reverseOrder(</div><div class="line">                (o1, o2) -&gt; ObjectUtils.compare(o1.getDate(), o2.getDate())</div><div class="line">        )</div><div class="line">);</div><div class="line">System.out.println(JSON.toJSONString(apples, SerializerFeature.WriteDateUseDateFormat));</div></pre></td></tr></table></figure>
<h3 id="谓词复合"><a href="#谓词复合" class="headerlink" title="谓词复合"></a>谓词复合</h3><p>包括： negate、and 和 or</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// negate</span></div><div class="line">Predicate&lt;Apple&gt; notRedApple = redApple.negate();</div><div class="line"></div><div class="line"><span class="comment">// and</span></div><div class="line">notRedApple.and((apple) -&gt; apple.getWeight() &gt; <span class="number">150</span>)</div></pre></td></tr></table></figure>
<h3 id="函数复合"><a href="#函数复合" class="headerlink" title="函数复合"></a>函数复合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Function&lt;Integer, Integer&gt; f = (x) -&gt; x + <span class="number">1</span>;</div><div class="line">Function&lt;Integer, Integer&gt; g = (x) -&gt; x * <span class="number">2</span>;</div><div class="line"></div><div class="line"><span class="comment">// h = g(f(x))</span></div><div class="line">Function&lt;Integer, Integer&gt; h = f.andThen(g);</div><div class="line"><span class="comment">// k = f(g(x))</span></div><div class="line">Function&lt;Integer, Integer&gt; k = f.compose(g);</div></pre></td></tr></table></figure>
<h1 id="流"><a href="#流" class="headerlink" title="流"></a>流</h1><p>java8用Stream API解决两个问题；</p>
<ul>
<li>集合处理时的套路和晦涩</li>
<li>难以利用多核</li>
</ul>
<p>Collection主要为了存储和访问数据，Stream主要用于描述对数据的计算。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//库存</span></div><div class="line">List&lt;Apple&gt; apples = Arrays.asList(</div><div class="line">                <span class="keyword">new</span> Apple(<span class="string">"green"</span>, <span class="number">80</span>),</div><div class="line">                <span class="keyword">new</span> Apple(<span class="string">"red"</span>, <span class="number">155</span>),</div><div class="line">                <span class="keyword">new</span> Apple(<span class="string">"yellow"</span>, <span class="number">120</span>)</div><div class="line">        );</div><div class="line"></div><div class="line"><span class="comment">// 满足重量条件、获取颜色</span></div><div class="line">List&lt;String&gt; weightAppleColors = apples</div><div class="line">        .stream()</div><div class="line">        .filter(apple -&gt; apple.getWeight() &gt; <span class="number">150</span>)</div><div class="line">        .sorted(Comparator.comparing(Apple::getWeight))</div><div class="line">        .map(Apple::getColor)</div><div class="line">        .collect(Collectors.toList());</div><div class="line"></div><div class="line"><span class="comment">// 并行计算流</span></div><div class="line">apples.parallelStream();</div><div class="line"></div><div class="line"><span class="comment">// 分组为map</span></div><div class="line">Map&lt;String, List&lt;Apple&gt;&gt; colorMap = apples.stream()</div><div class="line">                .collect(Collectors.groupingBy(Apple::getColor));</div><div class="line"></div><div class="line"><span class="comment">// flatMap 多个流合并成一个流</span></div><div class="line"><span class="comment">// Stream&lt;String[]&gt; -&gt; flatMap -&gt; Stream&lt;String&gt;</span></div><div class="line">Student obj1 = <span class="keyword">new</span> Student();</div><div class="line">obj1.setName(<span class="string">"mkyong"</span>);</div><div class="line">obj1.addBook(<span class="string">"Java 8 in Action"</span>);</div><div class="line">obj1.addBook(<span class="string">"Spring Boot in Action"</span>);</div><div class="line">obj1.addBook(<span class="string">"Effective Java (2nd Edition)"</span>);</div><div class="line"></div><div class="line">Student obj2 = <span class="keyword">new</span> Student();</div><div class="line">obj2.setName(<span class="string">"zilap"</span>);</div><div class="line">obj2.addBook(<span class="string">"Learning Python, 5th Edition"</span>);</div><div class="line">obj2.addBook(<span class="string">"Effective Java (2nd Edition)"</span>);</div><div class="line"></div><div class="line">List&lt;Student&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">list.add(obj1);</div><div class="line">list.add(obj2);</div><div class="line"></div><div class="line">List&lt;String&gt; collect =</div><div class="line">        list.stream()</div><div class="line">                .map(x -&gt; x.getBook())      <span class="comment">//Stream&lt;Set&lt;String&gt;&gt;</span></div><div class="line">                .flatMap(x -&gt; x.stream())   <span class="comment">//Stream&lt;String&gt;</span></div><div class="line">                .distinct()</div><div class="line">                .collect(Collectors.toList());</div></pre></td></tr></table></figure>
<p>Java中并行与无共享可变状态<br>库负责分块，即把大的流分成几个小的流，以便并行处理。<br>其次，流提供几乎免费的并行，只有传递给filter之类的库方法不会互动时才能工作。</p>
<p><code>函数式编程</code>函数的主要意思：</p>
<ul>
<li>把函数作为一等值</li>
<li>执行时在元素之间无互动</li>
</ul>
<h2 id="使用流"><a href="#使用流" class="headerlink" title="使用流"></a>使用流</h2><ul>
<li>一个数据源</li>
<li>一个中间操作链：可以连接起来的流操作称为中间操作。</li>
<li>一个终端终端操作：终端操作从流的流水线上生成结果。</li>
</ul>
<blockquote>
<p>流只能遍历一次</p>
</blockquote>
<p>中间操作：</p>
<ul>
<li>filter： 排除元素</li>
<li>map： 元素转成其他形式或提取信息</li>
<li>limit：截断流</li>
<li>sorted</li>
<li>distinct</li>
</ul>
<p>终端操作：</p>
<ul>
<li>forEach： 消费流中元素</li>
<li>count： 返回流中元素的个数</li>
<li>collect： 流归约成一个集合</li>
</ul>
<h3 id="joining"><a href="#joining" class="headerlink" title="joining"></a>joining</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">String[] animals = <span class="keyword">new</span> String[] &#123; <span class="string">"Dog"</span>, <span class="string">"Cat"</span>, <span class="string">"Bird"</span>, <span class="string">"Cow"</span> &#125;;</div><div class="line">String result = Arrays.stream(animals).collect(Collectors.joining(<span class="string">","</span>));</div><div class="line"></div><div class="line">String workOrderCodesStr = String.join(<span class="string">","</span>, workOrderCodes);</div><div class="line"></div><div class="line">assertEquals(result, <span class="string">"Dog, Cat, Bird, Cow"</span>);</div></pre></td></tr></table></figure>
<h1 id="默认方法"><a href="#默认方法" class="headerlink" title="默认方法"></a>默认方法</h1><p>java8中，接口可以包含实现类没有提供实现的方法签名，缺失的方法主体随接口提供</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoInterface</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">testFun</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//TODO default implementation</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>默认方法主要为了支持库设计是，让他们能够写出<code>更容易改进</code>的接口</p>
<p>无默认方法时，给接口加入一个新方法，意味着所有的实现类都必须为其提供一个实现</p>
<h1 id="新的日期和时间API"><a href="#新的日期和时间API" class="headerlink" title="新的日期和时间API"></a>新的日期和时间API</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//LocalDate：只包含日期，比如：2016-10-20</span></div><div class="line"><span class="comment">//LocalTime：只包含时间，比如：23:12:10</span></div><div class="line">LocalDate localDate = LocalDate.of(<span class="number">2017</span>, <span class="number">7</span>, <span class="number">1</span>);</div><div class="line">LocalTime localTime = LocalTime.of(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line"><span class="comment">//当前月份最后一秒</span></div><div class="line"><span class="comment">//LocalDateTime：包含日期和时间，比如：2016-10-20 23:14:21</span></div><div class="line">LocalDateTime localDateTime = LocalDateTime.of(localDate, localTime)</div><div class="line">        .plusMonths(<span class="number">1</span>)</div><div class="line">        .minusSeconds(<span class="number">1</span>);<span class="comment">//当前月第一天，后一个月，前一秒</span></div><div class="line"></div><div class="line"><span class="comment">//日期</span></div><div class="line">LocalDateTime now = LocalDateTime.now();</div><div class="line"><span class="comment">//日期格式化</span></div><div class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">String localDateTimeFormat = localDateTime.format(formatter);</div><div class="line">System.out.println(<span class="string">"LocalDateTime Date Formate: "</span> + localDateTimeFormat);</div><div class="line">String formatDateTime = now.format(formatter);</div><div class="line">System.out.println(<span class="string">"Now Date Formate: "</span> + formatDateTime);</div><div class="line"></div><div class="line"><span class="comment">//日期转时间戳</span></div><div class="line">Instant instant = localDateTime.toInstant(ZoneOffset.UTC);</div><div class="line">System.out.println(instant.getEpochSecond());</div><div class="line"></div><div class="line"><span class="comment">// String -&gt; LocalDateTime</span></div><div class="line">String dateStr = <span class="string">"2016-11-09 10:30"</span>;</div><div class="line">DateTimeFormatter dateStrFormatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm"</span>);</div><div class="line">LocalDateTime dateStrLocalDateTime = LocalDateTime.parse(dateStr, dateStrFormatter);</div><div class="line">System.out.println(<span class="string">"String -&gt; LocalDateTime: "</span> + dateStrLocalDateTime);</div></pre></td></tr></table></figure>
<h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">StringBuilder contentBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line"><span class="keyword">try</span> (Stream&lt;String&gt; stream = Files.lines(Paths.get(filePath), StandardCharsets.UTF_8)) &#123;</div><div class="line">    stream.forEach(s -&gt; contentBuilder.append(s).append(<span class="string">"\n"</span>));</div><div class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> contentBuilder.toString();</div><div class="line"></div><div class="line"><span class="comment">//读取全部文本</span></div><div class="line">String data = <span class="keyword">new</span> String(Files.readAllBytes(Paths.get(System.getProperty(<span class="string">"user.dir"</span>) + System.getProperty(<span class="string">"line.separator"</span>) + tmpDataSave + tmpDataSaveSuffix)), StandardCharsets.UTF_8);</div></pre></td></tr></table></figure>
<h1 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Optional&lt;String&gt; gender = Optional.of(<span class="string">"MALE"</span>);</div><div class="line">Optional&lt;String&gt; emptyGender = Optional.empty();</div><div class="line"></div><div class="line">System.out.println(gender.orElse(<span class="string">"&lt;N/A&gt;"</span>)); <span class="comment">//MALE</span></div><div class="line">System.out.println(emptyGender.orElse(<span class="string">"&lt;N/A&gt;"</span>)); <span class="comment">//&lt;N/A&gt;</span></div><div class="line"></div><div class="line">System.out.println(gender.orElseGet(() -&gt; <span class="string">"&lt;N/A&gt;"</span>)); <span class="comment">//MALE</span></div><div class="line">System.out.println(emptyGender.orElseGet(() -&gt; <span class="string">"&lt;N/A&gt;"</span>)); <span class="comment">//&lt;N/A&gt;</span></div></pre></td></tr></table></figure>
<h1 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h1><p><code>组合式异步编程</code></p>
<p>CompletableFuturene能够用最有效的方式，非常容易的将多个同步或异步执行的任务结合在一起</p>
<p>实现2个接口：</p>
<ul>
<li>CompletionStage</li>
<li>Future</li>
</ul>
<h2 id="Future接口"><a href="#Future接口" class="headerlink" title="Future接口"></a>Future接口</h2><table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean cancel(boolean mayInterruptIfRunning)</td>
<td>试图取消对此任务的执行。</td>
</tr>
<tr>
<td>V get()</td>
<td>尝如有必要，等待计算完成，然后获取其结果。</td>
</tr>
<tr>
<td>V get(long timeout, TimeUnit unit)</td>
<td>如有必要，最多等待为使计算完成所给定的时间之后，获取其结果（如果结果可用）。</td>
</tr>
<tr>
<td>boolean cancel(boolean mayInterruptIfRunning)</td>
<td>试图取消对此任务的执行。</td>
</tr>
<tr>
<td>boolean isCancelled()</td>
<td>果在任务正常完成前将其取消，则返回 true</td>
</tr>
<tr>
<td>boolean isDone()</td>
<td>如果任务已完成，则返回 true</td>
</tr>
</tbody>
</table>
<h2 id="CompletableFuture-1"><a href="#CompletableFuture-1" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h2><table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>public T getNow(T valueIfAbsent)</td>
<td>Returns the result value (or throws any encountered exception) if completed, else returns the given valueIfAbsent.</td>
</tr>
<tr>
<td>public T join()</td>
<td>Returns the result value when complete, or throws an (<code>unchecked</code>) exception if completed exceptionally.</td>
</tr>
</tbody>
</table>
<a href="https://colobu.com/2016/02/29/Java-CompletableFuture/" title="JavaCompletableFuture详解" target="_blank" rel="external">JavaCompletableFuture详解</a>
<a href="https://colobu.com/2018/03/12/20-Examples-of-Using-Java’s-CompletableFuture/" title="CompletableFuture20" target="_blank" rel="external">CompletableFuture20</a>
<h2 id="完成的CompletableFuture"><a href="#完成的CompletableFuture" class="headerlink" title="完成的CompletableFuture"></a>完成的CompletableFuture</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CompletableFuture cf = CompletableFuture.completedFuture(<span class="string">"message"</span>);</div></pre></td></tr></table></figure>
<h2 id="异步阶段"><a href="#异步阶段" class="headerlink" title="异步阶段"></a>异步阶段</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CompletableFuture.runAsync(() -&gt; &#123;</div><div class="line">    <span class="comment">// return void</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">CompletableFuture.supplyAsync(() -&gt; &#123;</div><div class="line">    <span class="comment">// return void</span></div><div class="line">    <span class="keyword">return</span> <span class="string">"return T"</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="在前一个阶段上应用函数"><a href="#在前一个阶段上应用函数" class="headerlink" title="在前一个阶段上应用函数"></a>在前一个阶段上应用函数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 同步</span></div><div class="line">CompletableFuture.supplyAsync(() -&gt; &#123;</div><div class="line">    <span class="comment">// return void</span></div><div class="line">    <span class="keyword">return</span> <span class="string">"return T"</span>;</div><div class="line">&#125;).thenAccept(System.out::println);</div><div class="line"></div><div class="line"><span class="comment">// 异步</span></div><div class="line">CompletableFuture.supplyAsync(() -&gt; &#123;</div><div class="line">    <span class="comment">// return void</span></div><div class="line">    <span class="keyword">return</span> <span class="string">"return T"</span>;</div><div class="line">&#125;).thenAcceptAsync(System.out::println);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">BasicThreadFactory threadFactory = <span class="keyword">new</span> BasicThreadFactory.Builder()</div><div class="line">                .namingPattern(<span class="string">"sys-async-thread-%d"</span>)</div><div class="line">                .daemon(<span class="keyword">true</span>)</div><div class="line">                .build();</div><div class="line">LinkedBlockingQueue&lt;Runnable&gt; blockingQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(<span class="number">1024</span>);</div><div class="line">ThreadPoolExecutor threadPool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">8</span>, <span class="number">64</span>, TimeUnit.SECONDS,blockingQueue, threadFactory, <span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</div><div class="line"></div><div class="line"><span class="comment">// 异步-指定线程池</span></div><div class="line">CompletableFuture.supplyAsync(() -&gt; &#123;</div><div class="line">    <span class="comment">// return void</span></div><div class="line">    <span class="keyword">return</span> <span class="string">"return T"</span>;</div><div class="line">&#125;).thenAcceptAsync(System.out::println, threadPool);</div></pre></td></tr></table></figure>
<h2 id="完成计算异常"><a href="#完成计算异常" class="headerlink" title="完成计算异常"></a>完成计算异常</h2><p><code>java.util.concurrent.CompletionStage#handle</code></p>
<blockquote>
<p>Returns a new CompletionStage that, when this stage completes either normally or exceptionally, is executed with this stage’s result and exception as arguments to the supplied function. </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">CompletableFuture&lt;String&gt; stringCompletableFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"return T"</span>;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">CompletableFuture&lt;String&gt; handleRet = stringCompletableFuture.handle((s, th) -&gt; &#123;</div><div class="line">    <span class="keyword">return</span> (th != <span class="keyword">null</span>) ? <span class="string">"completed exceptionally"</span> : s;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">handleRet.thenAccept(System.out::println);</div></pre></td></tr></table></figure>
<h2 id="取消计算"><a href="#取消计算" class="headerlink" title="取消计算"></a>取消计算</h2><p><code>java.util.concurrent.CompletableFuture#cancel</code></p>
<blockquote>
<p>等价于java.util.concurrent.CompletableFuture#completeExceptionally</p>
</blockquote>
<h2 id="任意一个CompletionStage完成的时候，fn会被执行"><a href="#任意一个CompletionStage完成的时候，fn会被执行" class="headerlink" title="任意一个CompletionStage完成的时候，fn会被执行"></a>任意一个CompletionStage完成的时候，fn会被执行</h2><p><code>java.util.concurrent.CompletionStage#acceptEither</code></p>
<blockquote>
<p>Returns a new CompletionStage that, when either this or the other given stage complete normally, is executed with the corresponding result as argument to the supplied action.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">String original = <span class="string">"Message"</span>;</div><div class="line">StringBuilder result = <span class="keyword">new</span> StringBuilder();</div><div class="line">CompletableFuture cf = CompletableFuture.completedFuture(original)</div><div class="line">            .thenApplyAsync(s -&gt; delayedUpperCase(s))</div><div class="line">            .acceptEither(CompletableFuture.completedFuture(original).thenApplyAsync(s -&gt; delayedLowerCase(s)),</div><div class="line">                    s -&gt; result.append(s).append(<span class="string">"acceptEither"</span>));</div><div class="line">cf.join();</div><div class="line">assertTrue(<span class="string">"Result was empty"</span>, result.toString().endsWith(<span class="string">"acceptEither"</span>));</div></pre></td></tr></table></figure>
<h2 id="在两个阶段都执行完后运行"><a href="#在两个阶段都执行完后运行" class="headerlink" title="在两个阶段都执行完后运行"></a>在两个阶段都执行完后运行</h2><p><code>java.util.concurrent.CompletionStage#runAfterBoth</code></p>
<blockquote>
<p>Returns a new CompletionStage that, when this and the other given stage both complete normally, executes the given action.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> String original = <span class="string">"Message"</span>;</div><div class="line">StringBuilder result = <span class="keyword">new</span> StringBuilder();</div><div class="line">CompletableFuture.completedFuture(original).thenApply(String::toUpperCase).runAfterBoth(</div><div class="line">        CompletableFuture.completedFuture(original).thenApply(String::toLowerCase),</div><div class="line">        () -&gt; result.append(<span class="string">"done"</span>));</div><div class="line">assertTrue(<span class="string">"Result was empty"</span>, result.length() &gt; <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h2 id="异步使用BiFunction处理两个阶段的结果"><a href="#异步使用BiFunction处理两个阶段的结果" class="headerlink" title="异步使用BiFunction处理两个阶段的结果"></a>异步使用BiFunction处理两个阶段的结果</h2><p><code>java.util.concurrent.CompletableFuture#thenCombine</code></p>
<blockquote>
<p>两个CompletableFuture并行执行，BiFunction处理结果</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">CompletableFuture cf = CompletableFuture.completedFuture(original).thenApply(s -&gt; delayedUpperCase(s))</div><div class="line">            .thenCompose(upper -&gt; CompletableFuture.completedFuture(original).thenApply(s -&gt; delayedLowerCase(s))</div><div class="line">                    .thenApply(s -&gt; upper + s));</div></pre></td></tr></table></figure>
<h2 id="当任意一个CompletableFuture完成后，-创建一个完成的CompletableFuture"><a href="#当任意一个CompletableFuture完成后，-创建一个完成的CompletableFuture" class="headerlink" title="当任意一个CompletableFuture完成后， 创建一个完成的CompletableFuture."></a>当任意一个CompletableFuture完成后， 创建一个完成的CompletableFuture.</h2><p><code>ava.util.concurrent.CompletableFuture#anyOf</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">StringBuilder result = <span class="keyword">new</span> StringBuilder();</div><div class="line">List messages = Arrays.asList(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>);</div><div class="line">List&lt;CompletableFuture&gt; futures = messages.stream()</div><div class="line">        .map(msg -&gt; CompletableFuture.completedFuture(msg).thenApply(s -&gt; delayedUpperCase(s)))</div><div class="line">        .collect(Collectors.toList());</div><div class="line">CompletableFuture.anyOf(futures.toArray(<span class="keyword">new</span> CompletableFuture[futures.size()])).whenComplete((res, th) -&gt; &#123;</div><div class="line">    <span class="keyword">if</span>(th == <span class="keyword">null</span>) &#123;</div><div class="line">        assertTrue(isUpperCase((String) res));</div><div class="line">        result.append(res);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">assertTrue(<span class="string">"Result was empty"</span>, result.length() &gt; <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h2 id="当所有的阶段都完成后创建一个阶段"><a href="#当所有的阶段都完成后创建一个阶段" class="headerlink" title="当所有的阶段都完成后创建一个阶段"></a>当所有的阶段都完成后创建一个阶段</h2><p><code>java.util.concurrent.CompletableFuture#allOf</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">List messages = Arrays.asList(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>);</div><div class="line">List&lt;CompletableFuture&gt; futures = messages.stream()</div><div class="line">        .map(msg -&gt; CompletableFuture.completedFuture(msg).thenApply(s -&gt; delayedUpperCase(s)))</div><div class="line">        .collect(Collectors.toList());</div><div class="line">CompletableFuture.allOf(futures.toArray(<span class="keyword">new</span> CompletableFuture[futures.size()])).whenComplete((v, th) -&gt; &#123;</div><div class="line">    futures.forEach(cf -&gt; assertTrue(isUpperCase(cf.getNow(<span class="keyword">null</span>))));</div><div class="line">    result.append(<span class="string">"done"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h1 id="solutions"><a href="#solutions" class="headerlink" title="solutions"></a>solutions</h1><h2 id="jvm-crash"><a href="#jvm-crash" class="headerlink" title="jvm crash"></a>jvm crash</h2><p><code>jdk1.8.0_20</code></p>
<p>pinpoint: the agent 1.6.2 crash for tomcat and elasticsearch or other jvm app </p>
<a href="https://bugs.openjdk.java.net/browse/JDK-8097231" title="JDK-8097231" target="_blank" rel="external">JDK-8097231</a>
<h2 id="java-Docker化部署GC变长"><a href="#java-Docker化部署GC变长" class="headerlink" title="java Docker化部署GC变长"></a>java Docker化部署GC变长</h2><p>docker中jvm获取到宿主机 cpu核数，gc线程数计算错误</p>
<p><a href="https://juejin.im/post/5b63ff20e51d4519946020b1" target="_blank" rel="external">https://juejin.im/post/5b63ff20e51d4519946020b1</a></p>
<blockquote>
<p>在Java SE 8u131以上的版本后，已经可以正确识别Docker设定的CPU资源限制，不用再显式设定ParallelGCThreads和CICompilerCount，而内存方面的识别还需要以下参数：-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap</p>
</blockquote>
<p><a href="https://blogs.oracle.com/java-platform-group/java-se-support-for-docker-cpu-and-memory-limits" target="_blank" rel="external">https://blogs.oracle.com/java-platform-group/java-se-support-for-docker-cpu-and-memory-limits</a></p>
<p>Java 8u131及以上版本开始支持了Docker的cpu和memory限制<br><a href="https://juejin.im/post/5ac226aaf265da237e09e4dc" target="_blank" rel="external">https://juejin.im/post/5ac226aaf265da237e09e4dc</a></p>
<h2 id="ConcurrentHashSet"><a href="#ConcurrentHashSet" class="headerlink" title="ConcurrentHashSet"></a>ConcurrentHashSet</h2><p>you produce a concurrent hash set backed by a concurrent hash map, by using Collections.newSetFromMap(map)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Set&lt;Long&gt; codes = Collections.newSetFromMap(<span class="keyword">new</span> ConcurrentHashMap&lt;&gt;());</div></pre></td></tr></table></figure>
<a href="https://stackoverflow.com/questions/6992608/why-there-is-no-concurrenthashset-against-concurrenthashmap" title="why-there-is-no-concurrenthashset-against-concurrenthashmap" target="_blank" rel="external">why-there-is-no-concurrenthashset-against-concurrenthashmap</a>
      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/21/js-jquery-note/" rel="next" title="JQuery Note">
                <i class="fa fa-chevron-left"></i> JQuery Note
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/12/java-core/" rel="prev" title="Java Core">
                Java Core <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="xiaozhuang" />
          <p class="site-author-name" itemprop="name">xiaozhuang</p>
          <p class="site-description motion-element" itemprop="description">O ever youthful</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#方法和Lambda作为一等公民"><span class="nav-number">1.</span> <span class="nav-text">方法和Lambda作为一等公民</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#通过行为参数化传递代码"><span class="nav-number">2.</span> <span class="nav-text">通过行为参数化传递代码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lambda表达式"><span class="nav-number">3.</span> <span class="nav-text">Lambda表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#函数式接口"><span class="nav-number">3.1.</span> <span class="nav-text">函数式接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#环绕执行模式"><span class="nav-number">3.2.</span> <span class="nav-text">环绕执行模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用函数式接口"><span class="nav-number">3.3.</span> <span class="nav-text">使用函数式接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Predicate"><span class="nav-number">3.3.1.</span> <span class="nav-text">Predicate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer"><span class="nav-number">3.3.2.</span> <span class="nav-text">Consumer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Function"><span class="nav-number">3.3.3.</span> <span class="nav-text">Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数接口汇总"><span class="nav-number">3.3.4.</span> <span class="nav-text">函数接口汇总</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原始类型特化"><span class="nav-number">3.3.5.</span> <span class="nav-text">原始类型特化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类型检查、类型推断以及限制"><span class="nav-number">3.4.</span> <span class="nav-text">类型检查、类型推断以及限制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#类型检查"><span class="nav-number">3.4.1.</span> <span class="nav-text">类型检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#局部变量"><span class="nav-number">3.4.2.</span> <span class="nav-text">局部变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法引用"><span class="nav-number">3.4.3.</span> <span class="nav-text">方法引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构造方法引用"><span class="nav-number">3.4.4.</span> <span class="nav-text">构造方法引用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#复合Lambda表达式"><span class="nav-number">3.5.</span> <span class="nav-text">复合Lambda表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#比较器复合"><span class="nav-number">3.5.1.</span> <span class="nav-text">比较器复合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#谓词复合"><span class="nav-number">3.5.2.</span> <span class="nav-text">谓词复合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数复合"><span class="nav-number">3.5.3.</span> <span class="nav-text">函数复合</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#流"><span class="nav-number">4.</span> <span class="nav-text">流</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用流"><span class="nav-number">4.1.</span> <span class="nav-text">使用流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#joining"><span class="nav-number">4.1.1.</span> <span class="nav-text">joining</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#默认方法"><span class="nav-number">5.</span> <span class="nav-text">默认方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#新的日期和时间API"><span class="nav-number">6.</span> <span class="nav-text">新的日期和时间API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#读取文件"><span class="nav-number">6.1.</span> <span class="nav-text">读取文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Optional"><span class="nav-number">7.</span> <span class="nav-text">Optional</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CompletableFuture"><span class="nav-number">8.</span> <span class="nav-text">CompletableFuture</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Future接口"><span class="nav-number">8.1.</span> <span class="nav-text">Future接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CompletableFuture-1"><span class="nav-number">8.2.</span> <span class="nav-text">CompletableFuture</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#完成的CompletableFuture"><span class="nav-number">8.3.</span> <span class="nav-text">完成的CompletableFuture</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异步阶段"><span class="nav-number">8.4.</span> <span class="nav-text">异步阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在前一个阶段上应用函数"><span class="nav-number">8.5.</span> <span class="nav-text">在前一个阶段上应用函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#完成计算异常"><span class="nav-number">8.6.</span> <span class="nav-text">完成计算异常</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#取消计算"><span class="nav-number">8.7.</span> <span class="nav-text">取消计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任意一个CompletionStage完成的时候，fn会被执行"><span class="nav-number">8.8.</span> <span class="nav-text">任意一个CompletionStage完成的时候，fn会被执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在两个阶段都执行完后运行"><span class="nav-number">8.9.</span> <span class="nav-text">在两个阶段都执行完后运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异步使用BiFunction处理两个阶段的结果"><span class="nav-number">8.10.</span> <span class="nav-text">异步使用BiFunction处理两个阶段的结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#当任意一个CompletableFuture完成后，-创建一个完成的CompletableFuture"><span class="nav-number">8.11.</span> <span class="nav-text">当任意一个CompletableFuture完成后， 创建一个完成的CompletableFuture.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#当所有的阶段都完成后创建一个阶段"><span class="nav-number">8.12.</span> <span class="nav-text">当所有的阶段都完成后创建一个阶段</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#solutions"><span class="nav-number">9.</span> <span class="nav-text">solutions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#jvm-crash"><span class="nav-number">9.1.</span> <span class="nav-text">jvm crash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java-Docker化部署GC变长"><span class="nav-number">9.2.</span> <span class="nav-text">java Docker化部署GC变长</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ConcurrentHashSet"><span class="nav-number">9.3.</span> <span class="nav-text">ConcurrentHashSet</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiaozhuang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




  
  
  
  <script type="text/javascript">
    $(document).ready(function () {
      if ( $('#local-search-input').size() === 0) {
        return;
      }

      // Popup Window;
      var isfetched = false;
      // Search DB path;
      var search_path = "search.xml";
      if (search_path.length == 0) {
        search_path = "search.xml";
      }
      var path = "/" + search_path;
      // monitor main search box;

      function proceedsearch() {
        $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
        $('.popup').toggle();

      }
      // search function;
      var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
          url: path,
          dataType: "xml",
          async: true,
          success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
              return {
                title: $( "title", this ).text(),
                content: $("content",this).text(),
                url: $( "url" , this).text()
              };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
              var matchcounts = 0;
              var str='<ul class=\"search-result-list\">';
              var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
              $resultContent.innerHTML = "";
              if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                  var isMatch = true;
                  var content_index = [];
                  var data_title = data.title.trim().toLowerCase();
                  var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                  var data_url = data.url;
                  var index_title = -1;
                  var index_content = -1;
                  var first_occur = -1;
                  // only match artiles with not empty titles and contents
                  if(data_title != '' && data_content != '') {
                    keywords.forEach(function(keyword, i) {
                      index_title = data_title.indexOf(keyword);
                      index_content = data_content.indexOf(keyword);
                      if( index_title < 0 && index_content < 0 ){
                        isMatch = false;
                      } else {
                        if (index_content < 0) {
                          index_content = 0;
                        }
                        if (i == 0) {
                          first_occur = index_content;
                        }
                      }
                    });
                  }
                  // show search results
                  if (isMatch) {
                    matchcounts += 1;
                    str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                    var content = data.content.trim().replace(/<[^>]+>/g,"");
                    if (first_occur >= 0) {
                      // cut out 100 characters
                      var start = first_occur - 20;
                      var end = first_occur + 80;
                      if(start < 0){
                        start = 0;
                      }
                      if(start == 0){
                        end = 50;
                      }
                      if(end > content.length){
                        end = content.length;
                      }
                      var match_content = content.substring(start, end);
                      // highlight all keywords
                      keywords.forEach(function(keyword){
                        var regS = new RegExp(keyword, "gi");
                        match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                      });

                      str += "<p class=\"search-result\">" + match_content +"...</p>"
                    }
                    str += "</li>";
                  }
                })};
              str += "</ul>";
              if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
              if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
              $resultContent.innerHTML = str;
            });
            proceedsearch();
          }
        });}

      // handle and trigger popup window;
      $('.popup-trigger').mousedown(function(e) {
        e.stopPropagation();
        if (isfetched == false) {
          searchFunc(path, 'local-search-input', 'local-search-result');
        } else {
          proceedsearch();
        };

      });

      $('.popup-btn-close').click(function(e){
        $('.popup').hide();
        $(".popoverlay").remove();
        $('body').css('overflow', '');
      });
      $('.popup').click(function(e){
        e.stopPropagation();
      });
    });
  </script>


  

  

  
  


</body>
</html>
