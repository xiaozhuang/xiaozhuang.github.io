<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java,Spring," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Spring IoC、AOP、SpringMVC">
<meta name="keywords" content="Java,Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="http://xiaozhuang.github.io/2017/05/23/spring/index.html">
<meta property="og:site_name" content="Communicat &amp; Happy Together">
<meta property="og:description" content="Spring IoC、AOP、SpringMVC">
<meta property="og:updated_time" content="2019-08-19T13:02:38.804Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring">
<meta name="twitter:description" content="Spring IoC、AOP、SpringMVC">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6286766081142949000,
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>




  <title> Spring | Communicat & Happy Together </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Communicat & Happy Together</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Spring
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-23T18:24:42+08:00" content="2017-05-23">
              2017-05-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Spring IoC、AOP、SpringMVC<br><a id="more"></a></p>
<h1 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h1><h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 手动写Response</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeDataToResponse</span><span class="params">(Object data, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    PrintWriter out = response.getWriter();</div><div class="line">    response.setContentType(<span class="string">"application/json"</span>);</div><div class="line">    response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">    <span class="comment">// 非String类型key转为String</span></div><div class="line">    out.print(JSON.toJSONString(data, SerializerFeature.WriteNonStringKeyAsString));</div><div class="line">    out.flush();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="default-servlet-handler"><a href="#default-servlet-handler" class="headerlink" title="default-servlet-handler"></a>default-servlet-handler</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 请求已经作映射，后台对应的处理程序，没有作映射，WEB应用服务器默认的Servlet处理，从而找到对应的静态资源 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 更进一步，由Spring MVC框架处理静态资源，允许静态资源放在任何地方，如WEB-INF目录下、类路径下等，甚至可以将JavaScript等静态文件打到JAR包中--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/,classpath:/META-INF/publicResources/"</span> <span class="attr">mapping</span>=<span class="string">"/resources/**"</span>/&gt;</span></div><div class="line"><span class="comment">&lt;!-- static包静态加载 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/static/**"</span> <span class="attr">location</span>=<span class="string">"/static/"</span> /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// javaConfig spring mvc resources</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(<span class="keyword">final</span> ResourceHandlerRegistry registry)</span> </span>&#123;</div><div class="line">    registry.addResourceHandler(<span class="string">"/resources/**"</span>).addResourceLocations(<span class="string">"/resources/"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="DispatcherServlet"><a href="#DispatcherServlet" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>The pattern / will make your servlet the default servlet for the app, meaning it will pick up every pattern that doesn’t have another exact match.</p>
</blockquote>
<a href="https://stackoverflow.com/questions/17360374/dispatcher-servlet-spring-and-url-pattern?rq=1" title="DispatcherServletUrl" target="_blank" rel="external">DispatcherServletUrl</a>
<h2 id="Reponse-application-json"><a href="#Reponse-application-json" class="headerlink" title="Reponse application/json"></a>Reponse application/json</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/foo"</span>, method=RequestMethod.GET, produces = <span class="string">"application/json"</span>)</div></pre></td></tr></table></figure>
<h2 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="ModelAttribute"></a>ModelAttribute</h2><h3 id="方法使用-ModelAttribute标注"><a href="#方法使用-ModelAttribute标注" class="headerlink" title="方法使用@ModelAttribute标注"></a>方法使用@ModelAttribute标注</h3><p>标注了@ModelAttribute的方法实际上会在@RequestMapping方法之前被调用<br>@ModelAttribute说明方法是用于添加一个或多个属性到model上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式一，方法接收一个Model对象，然后可以向其中添加任意数量的属性</span></div><div class="line"><span class="meta">@ModelAttribute</span>  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">populateModel</span><span class="params">(@RequestParam String abc, Model model)</span> </span>&#123;  </div><div class="line">   model.addAttribute(<span class="string">"attributeName"</span>, abc);  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 方式二，方法通过返回值的方式默认地将添加一个属性，框架将根据属性的类型给予一个默认名称</span></div><div class="line"><span class="meta">@ModelAttribute</span></div><div class="line"><span class="function"><span class="keyword">public</span> Account <span class="title">addAccount</span><span class="params">(@RequestParam String number)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> accountManager.findAccount(number);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="方法参数使用-ModelAttribute标注"><a href="#方法参数使用-ModelAttribute标注" class="headerlink" title="方法参数使用@ModelAttribute标注"></a>方法参数使用@ModelAttribute标注</h3><p>标注在方法参数上的@ModelAttribute说明了该方法参数的值将由model中取得</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;/edit"</span>, method = RequestMethod.POST)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processSubmit</span><span class="params">(@ModelAttribute Pet pet)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><h2 id="获取User-Agent"><a href="#获取User-Agent" class="headerlink" title="获取User-Agent"></a>获取User-Agent</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//handler加参数</span></div><div class="line"><span class="function"><span class="keyword">public</span> ResultInfo <span class="title">submit</span><span class="params">(HttpServletRequest req, @ModelAttribute(value = <span class="string">"serviceProductInfo"</span>)</span> ServiceProductInfo serviceProductInfo, @<span class="title">RequestHeader</span><span class="params">(<span class="string">"User-Agent"</span>)</span> String userAgent) </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><p>适合场景性能监控、访问控制、事务管理及日志记录</p>
<p>Spring只能支持方法拦截的AOP</p>
<p>Spring中4中方式实现aop拦截功能</p>
<ul>
<li>使用ProxyFactoryBean和对应接口实现AOP</li>
<li>使用XML配置AOP</li>
<li>使用@AspectJ注解驱动切面</li>
<li>使用AspectJ注入切面</li>
</ul>
<h2 id="切面顺序"><a href="#切面顺序" class="headerlink" title="切面顺序"></a>切面顺序</h2><p>目标执行前（进入时），优先级高的通知先执行，<br>目标执行后（出来时），优先级高的通知后执行</p>
<blockquote>
<p>order约小，优先级越高；默认：LOWEST_PRECEDENCE<br>Spring aop 如一个同心圆，目标方法为圆心，外层切面order小</p>
</blockquote>
<p>未指定顺序，Spring AOP将以<code>随机的顺序</code>来织入这两个增强处理。</p>
<p>方法1：实现org.springframework.core.Ordered接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>  </div><div class="line"><span class="meta">@Aspect</span>  </div><div class="line"><span class="meta">@Slf</span>4j  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageQueueAopAspect1</span> <span class="keyword">implements</span> <span class="title">Ordered</span></span>&#123;</div><div class="line">	<span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>方法2：注解：org.springframework.core.annotation.Order </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>  </div><div class="line"><span class="meta">@Aspect</span>  </div><div class="line"><span class="meta">@Slf</span>4j  </div><div class="line"><span class="meta">@Order</span>(<span class="number">1</span>)  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageQueueAopAspect1</span></span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>方法3：配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">expose-proxy</span>=<span class="string">"true"</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"aopBean"</span> <span class="attr">order</span>=<span class="string">"0"</span>&gt;</span>    </div><div class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"testPointcut"</span>  <span class="attr">expression</span>=<span class="string">"@annotation(xxx.xxx.xxx.annotation.xxx)"</span>/&gt;</span>    </div><div class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">pointcut-ref</span>=<span class="string">"testPointcut"</span> <span class="attr">method</span>=<span class="string">"doAround"</span> /&gt;</span>    </div><div class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span>    </div><div class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>Around advice（环绕通知），多个切面，前面切面不调用jp.proceed()直接return，之后的切面不执行；<br>环绕通知不执行目标方法情况下，前置通知不执行；后置通知和返回通知执行</p>
</blockquote>
<h2 id="AOP-Solutions"><a href="#AOP-Solutions" class="headerlink" title="AOP Solutions"></a>AOP Solutions</h2><h3 id="自定义AOP-注解-在同一个类中的方法级别调用导致aop注解失效"><a href="#自定义AOP-注解-在同一个类中的方法级别调用导致aop注解失效" class="headerlink" title="自定义AOP 注解 在同一个类中的方法级别调用导致aop注解失效"></a>自定义AOP 注解 在同一个类中的方法级别调用导致aop注解失效</h3><ol>
<li>AOP上下文暴露代理对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(TicketService)AopContext.currentProxy()</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 基于@AspectJ切面的驱动器 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- 自动为容器中匹配@AspectJ切面Bean创建代理，完成切面织入 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 使用CGlib动态代理增强 proxy-target-class默认为false --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- exposeProxy = true,AOP上下文暴露代理对象 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- (TicketService)AopContext.currentProxy()获取当前代理对象 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span> <span class="attr">expose-proxy</span>=<span class="string">"true"</span>/&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Spring4.3</span></div><div class="line"><span class="meta">@EnableAspectJAutoProxy</span>(exposeProxy=<span class="keyword">true</span>, proxyTargetClass=<span class="keyword">false</span>)</div></pre></td></tr></table></figure>
<ol>
<li>通过ApplicationContext获取代理对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringUtil</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span></span></div><div class="line">            <span class="keyword">throws</span> BeansException &#123;</div><div class="line">        <span class="keyword">if</span> (SpringUtil.applicationContext == <span class="keyword">null</span>) &#123;</div><div class="line">            SpringUtil.applicationContext = applicationContext;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//获取applicationContext</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title">getApplicationContext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> applicationContext;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//通过name获取 Bean.</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String name)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> getApplicationContext().getBean(name);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//通过class获取Bean.</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; clazz)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> getApplicationContext().getBean(clazz);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//通过name,以及Clazz返回指定的Bean</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String name,Class&lt;T&gt; clazz)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> getApplicationContext().getBean(name, clazz);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>自注入</li>
</ol>
<h3 id="自注入"><a href="#自注入" class="headerlink" title="自注入"></a>自注入</h3><p><code>Self injection with Spring</code><br>Self autowiring will be officially supported in Spring Framework 4.3. The implementation can be seen in this GitHub commit.<br><a href="https://github.com/spring-projects/spring-framework/commit/4a0fa69ce469cae2e8c8a1a45f0b43f74a74481d" target="_blank" rel="external">https://github.com/spring-projects/spring-framework/commit/4a0fa69ce469cae2e8c8a1a45f0b43f74a74481d</a></p>
<p>It is totally ok. Moreover there was a Jira ticket for supporting this feature using @Autowired annotations. It’s fixed in Spring 4.3+ versions.<br>However for xml-based configuration or using @Resource annotation it’s working in the earlier versions.</p>
<p><a href="https://jira.spring.io/browse/SPR-8450?focusedCommentId=121028&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-121028" target="_blank" rel="external">https://jira.spring.io/browse/SPR-8450?focusedCommentId=121028&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-121028</a><br><a href="https://stackoverflow.com/questions/5152686/self-injection-with-spring" target="_blank" rel="external">https://stackoverflow.com/questions/5152686/self-injection-with-spring</a></p>
<a href="https://stackoverflow.com/questions/5152686/self-injection-with-spring" title="Self injection with Spring" target="_blank" rel="external">Self injection with Spring</a>
<a href="https://jira.spring.io/browse/SPR-8450?focusedCommentId=121028&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-121028" title="Support @Autowired-like self injection" target="_blank" rel="external">Support @Autowired-like self injection</a>
<h3 id="AutoProxyCreator"><a href="#AutoProxyCreator" class="headerlink" title="AutoProxyCreator"></a>AutoProxyCreator</h3><p>beanName “org.springframework.aop.config.internalAutoProxyCreator”</p>
<p>基于注解的切面创建器<br>org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator</p>
<h2 id="注入多个相同类型Bean"><a href="#注入多个相同类型Bean" class="headerlink" title="注入多个相同类型Bean"></a>注入多个相同类型Bean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 移除List类型bean</span></div><div class="line"></div><div class="line"><span class="comment">// 方式1</span></div><div class="line"><span class="meta">@Autowired</span></div><div class="line"><span class="keyword">private</span> MovieCatalog[] movieCatalogs;</div><div class="line"></div><div class="line"><span class="comment">// 方式2</span></div><div class="line"><span class="meta">@Autowired</span></div><div class="line"><span class="keyword">private</span> List&lt;MovieCatalog&gt; daemons;</div></pre></td></tr></table></figure>
<a href="https://coderanch.com/t/685432/frameworks/Spring-autowire-implementation-Interface" title="Spring-autowire-implementation-Interface" target="_blank" rel="external">Spring-autowire-implementation-Interface</a>
<h2 id="onAround返回类型为void"><a href="#onAround返回类型为void" class="headerlink" title="onAround返回类型为void"></a>onAround返回类型为void</h2><p>切面方法返回值类型为void，onAround跳过方法执行，返回null</p>
<a href="https://stackoverflow.com/questions/2408626/returning-a-void-object" title="returning-a-void-object" target="_blank" rel="external">returning-a-void-objec</a>
<h2 id="ProxyFactoryBean"><a href="#ProxyFactoryBean" class="headerlink" title="ProxyFactoryBean"></a>ProxyFactoryBean</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionServiceProxy"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span></span></div><div class="line">    <span class="attr">p:interceptorNames</span>=<span class="string">"learnThrowsAdvice"</span> </div><div class="line">    <span class="attr">p:target-ref</span>=<span class="string">"transactionService"</span></div><div class="line">    <span class="attr">p:proxyTargetClass</span>=<span class="string">"true"</span> /&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>TODD</p>
</blockquote>
<h2 id="AOP-通知类型"><a href="#AOP-通知类型" class="headerlink" title="AOP 通知类型"></a>AOP 通知类型</h2><h3 id="环绕通知（Around）"><a href="#环绕通知（Around）" class="headerlink" title="环绕通知（Around）"></a>环绕通知（Around）</h3><p>目标方法<code>调用之前</code>和<code>调用之后</code>执行自定义行为</p>
<h3 id="前置通知（Before）"><a href="#前置通知（Before）" class="headerlink" title="前置通知（Before）"></a>前置通知（Before）</h3><p>目标方法<code>调用之前</code>调用</p>
<h3 id="后置通知（After）"><a href="#后置通知（After）" class="headerlink" title="后置通知（After）"></a>后置通知（After）</h3><p>目标<code>方法调用</code>之后调用</p>
<h3 id="返回通知（After-returning）"><a href="#返回通知（After-returning）" class="headerlink" title="返回通知（After-returning）"></a>返回通知（After-returning）</h3><p>目标方法<code>成功执行之后</code>调用</p>
<h3 id="异常通知（After-throwing）"><a href="#异常通知（After-throwing）" class="headerlink" title="异常通知（After-throwing）"></a>异常通知（After-throwing）</h3><p>目标方法<code>抛出异常后</code>调用</p>
<h2 id="AspectJ-表达式"><a href="#AspectJ-表达式" class="headerlink" title="AspectJ 表达式"></a>AspectJ 表达式</h2><p>组合切入点表达式</p>
<p>AspectJ使用 且 &amp;&amp;、或 ||、非 ！组合切入点表达式</p>
<p>Schema风格下，由于在XML中使用转义字符很不方便<br>Spring 提供 and、or、not来代替&amp;&amp;、||、！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Before</span>(<span class="string">"com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)"</span>) </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditable auditable)</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
<h3 id="execution"><a href="#execution" class="headerlink" title="execution()"></a>execution()</h3><p><code>Pointcut Expression</code></p>
<p>用于匹配连接点的执行方法</p>
<p>execution(方法表达式)</p>
<p>execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)</p>
<ul>
<li>modifiers-pattern：方法的访问类型，public等</li>
<li>ret-type-pattern：方法的返回值类型</li>
<li>declaring-type-pattern：方法的声明类</li>
<li>name-pattern：方法的名称</li>
<li>param-pattern：方法参数的类型</li>
<li>throws-pattern：异常类型</li>
</ul>
<p>表达式语法</p>
<ul>
<li>*：任何数量字符</li>
<li>..：匹配任何数量字符的重复，如在<code>类型模式中匹配任何数量子包</code>；而在<code>方法参数模式中匹配任何数量参数</code></li>
<li>+：匹配指定类型的子类型；仅能作为后缀放在类型模式后边</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// any public method</span></div><div class="line">execution(<span class="keyword">public</span> * *(..))</div><div class="line"><span class="comment">// any method with a name beginning with "set"</span></div><div class="line">execution(* set*(..))</div><div class="line"><span class="comment">// any method defined by the AccountService interface</span></div><div class="line">execution(* com.xyz.service.AccountService.*(..))</div><div class="line"><span class="comment">// any method defined in the service package</span></div><div class="line">execution(* com.xyz.service.*.*(..))</div><div class="line"><span class="comment">// any method defined in the service package or a sub-package</span></div><div class="line">execution(* com.xyz.service..*.*(..))</div></pre></td></tr></table></figure>
<h3 id="annotation"><a href="#annotation" class="headerlink" title="@annotation()"></a>@annotation()</h3><p>限制匹配<code>带有指定注解</code>执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Pointcut</span>(<span class="string">"@annotation(com.example.annotation.UserAccessAnnotation)"</span>) </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userAccess</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="meta">@Before</span>(<span class="string">"com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditable auditable)</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
<h3 id="this"><a href="#this" class="headerlink" title="this()"></a>this()</h3><p>限制连接点匹配AOP代理的Bean引用为指定类型的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Before</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; this(usageTracked)"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recordUsage</span><span class="params">(UsageTracked usageTracked)</span> </span>&#123;</div><div class="line">     usageTracked.incrementUseCount();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="within"><a href="#within" class="headerlink" title="within()"></a>within()</h3><p>限制连接点匹配指定的类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">within(com.xyz.service..*)</div><div class="line">within(com.xyz.service.*)</div></pre></td></tr></table></figure>
<h3 id="within-1"><a href="#within-1" class="headerlink" title="@within()"></a>@within()</h3><p>限制连接点匹配<code>指定注解所标注</code>的<code>类型</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@within</span>(org.springframework.transaction.annotation.Transactional)</div></pre></td></tr></table></figure>
<h3 id="target"><a href="#target" class="headerlink" title="target()"></a>target()</h3><p>限制连接点匹配目标对象为<code>指定类型</code>的<code>类</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">target(com.xyz.service.AccountService)</div><div class="line"></div><div class="line"><span class="meta">@Before</span>(value=<span class="string">"com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)"</span>,</div><div class="line">        argNames=<span class="string">"bean,auditable"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Object bean, Auditable auditable)</span> </span>&#123;</div><div class="line">    AuditCode code = auditable.value();</div><div class="line">    <span class="comment">// ... use code and bean</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Before</span>(value=<span class="string">"com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)"</span>,</div><div class="line">        argNames=<span class="string">"bean,auditable"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(JoinPoint jp, Object bean, Auditable auditable)</span> </span>&#123;</div><div class="line">    AuditCode code = auditable.value();</div><div class="line">    <span class="comment">// ... use code, bean, and jp</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="target-1"><a href="#target-1" class="headerlink" title="@target()"></a>@target()</h3><p>限制连接点匹配目标对象为<code>指定类型注解标注</code>的<code>类</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@target</span>(org.springframework.transaction.annotation.Transactional)</div></pre></td></tr></table></figure>
<h3 id="args"><a href="#args" class="headerlink" title="args()"></a>args()</h3><p>限制连接点匹配<code>参数为指定类型</code>的执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">args(java.io.Serializable)</div><div class="line"></div><div class="line"><span class="meta">@AfterReturning</span>(value = <span class="string">"target(com.jd.jmq.client.producer.MessageProducer) &amp;&amp; args(message,..))"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSingleMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="keyword">this</span>.addMessage(message);</div><div class="line">    logger.info(JacksonUtil.toJson(message));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="args-1"><a href="#args-1" class="headerlink" title="@args()"></a>@args()</h3><p>限制连接点匹配<code>参数由指定注解标注</code>的执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@args</span>(com.xyz.security.Classified)</div><div class="line"></div><div class="line">Before(value = <span class="string">"execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)"</span>, argNames=<span class="string">"param"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeSampleMethod</span><span class="params">(MyType param)</span> </span>&#123;&#125;)</div></pre></td></tr></table></figure>
<p>在Spring AOP中，除了execution和bean指示符不能传递参数给通知方法，<code>其他指示符都可以将匹配的相应参数或对象自动传递给通知方法</code>。</p>
<p>args(param)将首先查找通知方法上同名的参数，并在<code>方法执行时（运行时）匹配传入的参数是使用该同名参数类型</code>，即java.lang.String；<br>如果匹配将把该被通知参数传递给通知方法上同名参数</p>
<p>在class文件中<code>没生成变量调试信息</code>是获取不到方法参数名字的。可使用argNames来指定参数名。</p>
<h3 id="bean"><a href="#bean" class="headerlink" title="bean()"></a>bean()</h3><p><code>Spring特有表达式</code></p>
<p>特定名称的Bean对象的执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bean(tradeService)</div><div class="line">bean(*Service)</div></pre></td></tr></table></figure>
<h3 id="reference-pointcut"><a href="#reference-pointcut" class="headerlink" title="reference pointcut"></a>reference pointcut</h3><p><code>Spring特有表达式</code></p>
<p>引用其他命名切入点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(public * com.sunday.spring_learn.service.*.*(..))"</span>)</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span></span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="meta">@Before</span>(<span class="string">"log()"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;&#125;</div></pre></td></tr></table></figure>
<h2 id="引介增强"><a href="#引介增强" class="headerlink" title="引介增强"></a>引介增强</h2><p>targetClass追加接口（或者说追加更多的方法）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockableMixin</span> </span>&#123;</div><div class="line">    <span class="meta">@DeclareParents</span>( value = <span class="string">"com.sunday.spring_learn.service.impl.FooServiceImpl"</span>, defaultImpl = LockableImpl.class )</div><div class="line">    <span class="keyword">public</span> Lockable lockable;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h1><h2 id="Java读取环境变量"><a href="#Java读取环境变量" class="headerlink" title="Java读取环境变量"></a>Java读取环境变量</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># VM arguments指定log4j配置文件</span></div><div class="line">-Dlog4j.configurationFile=path/to/log4j2.xml</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取配置</span></div><div class="line">System.getProperty(<span class="string">"log4j.configurationFile"</span>)</div></pre></td></tr></table></figure>
<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><h2 id="最好不要配置xsd文件的版本号"><a href="#最好不要配置xsd文件的版本号" class="headerlink" title="最好不要配置xsd文件的版本号"></a>最好不要配置xsd文件的版本号</h2><p>因为如果没有配置版本号，取的就是当前jar里的XSD文件，减少了各种风险。<br>而且这样约定大于配置的方式很优雅。</p>
<h1 id="自定义xml标签"><a href="#自定义xml标签" class="headerlink" title="自定义xml标签"></a>自定义xml标签</h1><p><code>命名空间</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">asyn:config</span> <span class="attr">enabled</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">asyn:strategy</span> <span class="attr">ref</span>=<span class="string">"asynMethodStrategyMySQL"</span>&gt;</span><span class="tag">&lt;/<span class="name">asyn:strategy</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">asyn:config</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="配置NamespaceHandler"><a href="#配置NamespaceHandler" class="headerlink" title="配置NamespaceHandler"></a>配置NamespaceHandler</h2><p><code>META-INF/spring.handlers</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http\://framework.ql.jd.com/schema/asyn=com.jd.ql.framework.asyn.config.handler.AsynNamespaceHandler</div></pre></td></tr></table></figure>
<h2 id="定义NamespaceHandler"><a href="#定义NamespaceHandler" class="headerlink" title="定义NamespaceHandler"></a>定义NamespaceHandler</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsynNamespaceHandler</span> <span class="keyword">extends</span> <span class="title">NamespaceHandlerSupport</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        registerBeanDefinitionParser(<span class="string">"config"</span>, <span class="keyword">new</span> AsynBeanDefinitionParser());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="BeanDefinitionParser"><a href="#BeanDefinitionParser" class="headerlink" title="BeanDefinitionParser"></a>BeanDefinitionParser</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsynBeanDefinitionParser</span> <span class="keyword">extends</span> <span class="title">AbstractSingleBeanDefinitionParser</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> Class&lt;?&gt; getBeanClass(Element element) &#123;</div><div class="line">        <span class="keyword">return</span> Asyn.class;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doParse</span><span class="params">(Element element, ParserContext parserContext, BeanDefinitionBuilder builder)</span> </span>&#123;</div><div class="line">        String enabled = element.getAttribute(<span class="string">"enabled"</span>);</div><div class="line">        <span class="keyword">if</span>(StringUtils.hasText(enabled))&#123;</div><div class="line">            builder.addPropertyValue(<span class="string">"enabled"</span>, enabled); </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        List&lt;Element&gt; childElts = DomUtils.getChildElements(element);</div><div class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(childElts))&#123;</div><div class="line">            List&lt;String&gt; strategys = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">            <span class="keyword">for</span> (Element elt: childElts) &#123;</div><div class="line">                String localName = parserContext.getDelegate().getLocalName(elt);</div><div class="line">                <span class="keyword">if</span>(<span class="string">"strategy"</span>.equals(localName))&#123;</div><div class="line">                    strategys.add(elt.getAttribute(<span class="string">"ref"</span>));</div><div class="line">                &#125;</div><div class="line">                builder.addPropertyValue(<span class="string">"strategy"</span>, strategys);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="配置schemas-xsd"><a href="#配置schemas-xsd" class="headerlink" title="配置schemas xsd"></a>配置schemas xsd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http\://framework.ql.jd.com/schema/asyn/asyn.xsd=com/jd/ql/framework/asyn/config/asyn.xsd</div></pre></td></tr></table></figure>
<p><code>xsd配置编辑软件 XMLSpy2013</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">"http://framework.ql.jd.com/schema/asyn"</span> <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span> <span class="attr">targetNamespace</span>=<span class="string">"http://framework.ql.jd.com/schema/asyn"</span> <span class="attr">elementFormDefault</span>=<span class="string">"qualified"</span> <span class="attr">attributeFormDefault</span>=<span class="string">"unqualified"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"config"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xsd:sequence</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"strategy"</span> <span class="attr">type</span>=<span class="string">"strategyType"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span> <span class="attr">maxOccurs</span>=<span class="string">"unbounded"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">xsd:sequence</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> <span class="attr">use</span>=<span class="string">"optional"</span> <span class="attr">default</span>=<span class="string">"asynConf"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"enabled"</span> <span class="attr">type</span>=<span class="string">"xsd:boolean"</span> <span class="attr">default</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xsd:complexType</span> <span class="attr">name</span>=<span class="string">"strategyType"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"ref"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> <span class="attr">use</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>root element 必须有属性(attribute) id</p>
<h1 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h1><p><code>工具方法</code></p>
<h2 id="SerializationUtils"><a href="#SerializationUtils" class="headerlink" title="SerializationUtils"></a>SerializationUtils</h2><p><code>Serializable</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] serialize(Object object)</div><div class="line">)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span></span></div></pre></td></tr></table></figure>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 字符串分隔</span></div><div class="line"><span class="comment">// String CONFIG_LOCATION_DELIMITERS = ",; \t\n";</span></div><div class="line"></div><div class="line">String dependents = <span class="string">"dc1,dc2;dc3"</span>;</div><div class="line">String[] tokenizeToStringArray = StringUtils.tokenizeToStringArray(dependents, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);</div><div class="line">System.out.println(JSON.toJSON(tokenizeToStringArray));</div><div class="line"></div><div class="line"><span class="comment">// 数组拼接字符串</span></div><div class="line">String arrayToDelimitedString = StringUtils.arrayToDelimitedString(tokenizeToStringArray, <span class="string">"|"</span>);</div><div class="line">System.out.println(arrayToDelimitedString);</div><div class="line"></div><div class="line"><span class="comment">// Convenience method to return a String array as a CSV String.</span></div><div class="line">org.springframework.util.StringUtils.arrayToCommaDelimitedString()</div></pre></td></tr></table></figure>
<h2 id="类加载"><a href="#类加载" class="headerlink" title="类加载"></a>类加载</h2><p><code>org.springframework.util.ClassUtils</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPresent</span><span class="params">(String className, ClassLoader classLoader)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</div><div class="line">        classLoader = ClassUtils.getDefaultClassLoader();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        forName(className, classLoader);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className, ClassLoader classLoader)</div><div class="line">        <span class="keyword">throws</span> ClassNotFoundException &#123;</div><div class="line">    <span class="keyword">if</span> (classLoader != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> classLoader.loadClass(className);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> Class.forName(className);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Map&lt;Object, Object&gt;&gt; resources =</div><div class="line">            <span class="keyword">new</span> NamedThreadLocal&lt;Map&lt;Object, Object&gt;&gt;(<span class="string">"Transactional resources"</span>);</div></pre></td></tr></table></figure>
<h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//获取方法</span></div><div class="line">Method invokeMethod = ReflectionUtils.findMethod(invokeType, invokeMethodName, paramTypes);</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">Object invokeRet = ReflectionUtils.invokeMethod(invokeMethod, invokeBean, args);</div><div class="line"></div><div class="line">ReflectionUtils.makeAccessible(<span class="keyword">this</span>.bridgedMethod);</div></pre></td></tr></table></figure>
<h2 id="注解读取"><a href="#注解读取" class="headerlink" title="注解读取"></a>注解读取</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// org.springframework.core.annotation.AnnotationUtils</span></div><div class="line"></div><div class="line">org.springframework.jmx.export.annotation.ManagedAttribute ann =</div><div class="line">                AnnotationUtils.findAnnotation(method, org.springframework.jmx.export.annotation.ManagedAttribute.class);</div><div class="line"><span class="keyword">if</span> (ann == <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line">ManagedAttribute managedAttribute = <span class="keyword">new</span> ManagedAttribute();</div><div class="line">AnnotationBeanUtils.copyPropertiesToBean(ann, managedAttribute, <span class="string">"defaultValue"</span>);</div><div class="line"><span class="keyword">if</span> (ann.defaultValue().length() &gt; <span class="number">0</span>) &#123;</div><div class="line">    managedAttribute.setDefaultValue(ann.defaultValue());</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> managedAttribute;</div></pre></td></tr></table></figure>
<h1 id="配置加载-properties、xml"><a href="#配置加载-properties、xml" class="headerlink" title="配置加载 properties、xml"></a>配置加载 properties、xml</h1><h2 id="使用Environment"><a href="#使用Environment" class="headerlink" title="使用Environment"></a>使用Environment</h2><p><code>spring3.1</code></p>
<blockquote>
<p>PropertySource加载的properties中的配置，可以通过Environment获取到</p>
</blockquote>
<h2 id="PropertySource"><a href="#PropertySource" class="headerlink" title="PropertySource"></a>PropertySource</h2><p>使用  @PropertySource 加载配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@PropertySources</span>(&#123;</div><div class="line">    <span class="meta">@PropertySource</span>(<span class="string">"classpath:db.properties"</span>),</div><div class="line">    <span class="meta">@PropertySource</span>(<span class="string">"classpath:redis.properties"</span>)</div><div class="line">&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> Environment env;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 静态(static) bean</div><div class="line">     * 支持<span class="doctag">@value</span>中使用的$&#123;…&#125;占位符</div><div class="line">     * PropertySourcesPlaceHolderConfigurer Bean only required for <span class="doctag">@Value</span>("&#123;&#125;") annotations.</div><div class="line">     * Remove this bean if you are not using <span class="doctag">@Value</span> annotations for injecting properties.</div><div class="line">     */</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title">propertySourcesPlaceholderConfigurer</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> JedisConnectionFactory <span class="title">jedisConnFactory</span><span class="params">(@Value(<span class="string">"$&#123;redis.usePool&#125;"</span>)</span> <span class="keyword">boolean</span> usePool)</span>&#123;</div><div class="line">        String redisHost = env.getProperty(<span class="string">"redis.host"</span>);</div><div class="line">        </div><div class="line">        JedisConnectionFactory jedisConnectionFactory = <span class="keyword">new</span> JedisConnectionFactory();</div><div class="line">        jedisConnectionFactory.setHostName(redisHost);</div><div class="line">        jedisConnectionFactory.setUsePool(usePool);</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> jedisConnectionFactory;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- PropertySource xml 配置方式 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- PropertySourcesPlaceholderConfigurer是BeanFactoryPostProcessor的一个实现, 功能为读取properties文件然后用properties文件中实际的值替换占位符变量($&#123;somename&#125;)  --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.PropertySourcesPlaceholderConfigurer"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignoreUnresolvablePlaceholders"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:application.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="使用SpEL表达式"><a href="#使用SpEL表达式" class="headerlink" title="使用SpEL表达式"></a>使用SpEL表达式</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 通过SpEL表达式#&#123;&#125;获取配置 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">util:properties</span> <span class="attr">id</span>=<span class="string">"config"</span> <span class="attr">location</span>=<span class="string">"classpath:props.properties"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ds"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"#&#123;config.driver&#125;"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"#&#123;config.url&#125;"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"#&#123;config.username&#125;"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"#&#123;config.password&#125;"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="通过Properties实体"><a href="#通过Properties实体" class="headerlink" title="通过Properties实体"></a>通过Properties实体</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- done logo xml 配置--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">util:properties</span> <span class="attr">location</span>=<span class="string">"classpath:system/done_logo.xml"</span> /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 代码获取properties</span></div><div class="line">Properties doneLogo = applicationContext.getBean(<span class="string">"doneLogo"</span>,Properties.class);</div></pre></td></tr></table></figure>
<h2 id="配置注入"><a href="#配置注入" class="headerlink" title="配置注入"></a>配置注入</h2><p>Spring中的 @Value 注解可以获得Spring容器中加载的全局变量。以注解的形式赋予bean的成员变量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1. Property Example</span></div><div class="line"><span class="comment">//@PropertySource("classpath:/config.properties&#125;")</span></div><div class="line"><span class="comment">//@Configuration</span></div><div class="line"></div><div class="line"><span class="comment">// 默认值</span></div><div class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;mongodb.url:127.0.0.1&#125;"</span>)</div><div class="line"><span class="keyword">private</span> String mongodbUrl;</div><div class="line"></div><div class="line"><span class="meta">@Value</span>(<span class="string">"#&#123;'$&#123;mongodb.url:172.0.0.1&#125;'&#125;"</span>)</div><div class="line"><span class="keyword">private</span> String mongodbUrl;</div><div class="line"></div><div class="line"><span class="meta">@Value</span>(<span class="string">"#&#123;config['mongodb.url']?:'127.0.0.1'&#125;"</span>)</div><div class="line"><span class="keyword">private</span> String mongodbUrl;</div><div class="line"></div><div class="line"><span class="meta">@Value</span>(<span class="string">"#&#123;aBean.age ?: 21&#125;"</span>)</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line"></div><div class="line"><span class="comment">// 默认为空</span></div><div class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;stuff.value:@null&#125;"</span>)</div><div class="line"><span class="keyword">private</span> String value;</div><div class="line"></div><div class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;app.name:#&#123;null&#125;&#125;"</span>)</div><div class="line">    <span class="keyword">private</span> String name;</div></pre></td></tr></table></figure>
<h2 id="使用-PropertiesFactoryBean"><a href="#使用-PropertiesFactoryBean" class="headerlink" title="使用 PropertiesFactoryBean"></a>使用 PropertiesFactoryBean</h2><p>PropertiesFacotryBean是FactoryBean的一个实现, 功能为读取properties文件然后将其封装成Properties类的一个Bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emailProps"</span></span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertiesFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"location"</span></span></div><div class="line">        <span class="attr">value</span>=<span class="string">"classpath:com/smart/fb/mails.properties"</span>&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"secApplicationProperties"</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertiesFactoryBean"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignoreResourceNotFound"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">     </div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 不能使用classpath*: --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:important.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:other2.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">PropertiesFactoryBean pfb = <span class="keyword">new</span> PropertiesFactoryBean();</div><div class="line">pfb.setLocation(TEST_PROPS);</div><div class="line">Properties localProps = <span class="keyword">new</span> Properties();</div><div class="line">localProps.setProperty(<span class="string">"key2"</span>, <span class="string">"value2"</span>);</div><div class="line">localProps.setProperty(<span class="string">"tb.array[0].age"</span>, <span class="string">"0"</span>);</div><div class="line">pfb.setProperties(localProps);</div><div class="line"></div><div class="line">pfb.afterPropertiesSet();</div><div class="line">Properties props = pfb.getObject();</div><div class="line">assertEquals(<span class="string">"99"</span>, props.getProperty(<span class="string">"tb.array[0].age"</span>));</div><div class="line">assertEquals(<span class="string">"value2"</span>, props.getProperty(<span class="string">"key2"</span>));</div></pre></td></tr></table></figure>
<h2 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h2><p><code>配置文件</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Resource classPathResource = <span class="keyword">new</span> ClassPathResource(<span class="string">"log4j2.xml"</span>);</div><div class="line">        </div><div class="line">FileSystemResource fileSystemResource = <span class="keyword">new</span> FileSystemResource(<span class="string">"F:\\XXX\\log4j2.xml"</span>);</div><div class="line"></div><div class="line">UrlResource urlResource = <span class="keyword">new</span> UrlResource(<span class="string">"http://libs.baidu.com/jquery/1.9.1/jquery.min.js"</span>);</div><div class="line"></div><div class="line">InputStreamResource inputStreamResource = <span class="keyword">new</span> InputStreamResource(<span class="keyword">new</span> FileInputStream(<span class="string">"F:\\XXX\\log4j2.xml"</span>));</div><div class="line"></div><div class="line">ByteArrayResource byteArrayResource = <span class="keyword">new</span> ByteArrayResource(<span class="keyword">new</span> String(<span class="string">"configData"</span>).getBytes());</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Ant模式通配符匹配</span></div><div class="line"><span class="comment">// ?    匹配任何单字符  </span></div><div class="line"><span class="comment">// *   匹配0或者任意数量的字符     </span></div><div class="line"><span class="comment">// **  匹配0或者更多的目录</span></div><div class="line">PathMatchingResourcePatternResolver resolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();</div><div class="line">Resource[] resources = resolver.getResources(<span class="string">"classpath:mybatis/**/*.xml"</span>);</div><div class="line"></div><div class="line">Resource resources = resolver.getResource(<span class="string">"file:F:\\done-logo.xml"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- classpath：只会到你的class路径中查找找文件;  --&gt;</span></div><div class="line"><span class="comment">&lt;!-- classpath*：不仅包含class路径，还包括jar文件中(class路径)进行查找；如果文件不存在，则不加载 --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- &lt;context:property-placeholder location="classpath*:conf/conf*.properties" /&gt; --&gt;</span></div><div class="line"><span class="comment">&lt;!-- &lt;context:property-placeholder location="classpath:conf/conf*.properties" ignore-unresolvable="true"/&gt; --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- ignore-resource-not-found：如果属性文件找不到，是否忽略，默认false，即不忽略，找不到将抛出异常  --&gt;</span></div><div class="line"><span class="comment">&lt;!-- ignore-unresolvable：是否忽略解析不到的属性，如果不忽略，找不到将抛出异常  --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- system-properties-mode 系统属性模式，ENVIRONMENT（默认），NEVER，OVERRIDE --&gt;</span></div><div class="line"><span class="comment">&lt;!-- </span></div><div class="line">ENVIRONMENT：使用Spring 3.1提供的PropertySourcesPlaceholderConfigurer，其他情况使用Spring 3.1之前的PropertyPlaceholderConfigurer </div><div class="line">OVERRIDE： PropertyPlaceholderConfigurer使用，因为在spring 3.1之前版本是没有Enviroment的，所以OVERRIDE是spring 3.1之前版本的Environment </div><div class="line">NEVER：只查找properties-ref、location；</div><div class="line"> --&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:redis.properties"</span> </span></div><div class="line">    <span class="attr">ignore-unresolvable</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">ignore-resource-not-found</span>=<span class="string">"true"</span>/&gt;</div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>= <span class="string">"propertyConfigurer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignoreUnresolvablePlaceholders"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:authen.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:waybill.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">    </div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisConnFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span></span></div><div class="line">    <span class="attr">p:host-name</span>=<span class="string">"$&#123;redis.hostName&#125;"</span> </div><div class="line">    <span class="attr">p:port</span>=<span class="string">"$&#123;resis.port&#125;"</span> </div><div class="line">    <span class="attr">p:timeout</span>=<span class="string">"$&#123;redis.timeout&#125;"</span></div><div class="line">    <span class="attr">p:password</span>=<span class="string">"$&#123;redis.password&#125;"</span> </div><div class="line">    <span class="attr">p:use-pool</span>=<span class="string">"$&#123;redis.usePool&#125;"</span> /&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 编程方式获取 property-placeholder的配置，支持默认值</span></div><div class="line">String driverClassName = beanFactory.resolveEmbeddedValue(<span class="string">"$&#123;datasource.driverClassName: defaultDriverClassName&#125;"</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>只能有一个context:property-placeholder；<br>不同模块xml，分别加载properties文件，Spring加载两个模块xml配置时，报错Could not resolve placeholder</p>
</blockquote>
<p>解决办法：<br>各层都按路径，载入properties，应用层优先级最高；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 不要这样多次加载，因为order配置，引起问题不易排查 --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 通配方式 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- service层 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">order</span>=<span class="string">"10"</span> <span class="attr">location</span>=<span class="string">"classpath*:conf/*.properties"</span>/&gt;</span></div><div class="line"><span class="comment">&lt;!-- web层 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">order</span>=<span class="string">"0"</span> <span class="attr">location</span>=<span class="string">"classpath*:conf/*.properties"</span>/&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 按文件制定方式 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- proxy 层 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">order</span>=<span class="string">"100"</span> <span class="attr">location</span>=<span class="string">"classpath:conf/waybill-refund-proxy.properties"</span>/&gt;</span></div><div class="line"><span class="comment">&lt;!-- service层 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">order</span>=<span class="string">"10"</span> <span class="attr">location</span>=<span class="string">"conf/wrefund-service.properties,conf/waybill-refund-proxy.properties"</span>/&gt;</span></div><div class="line"><span class="comment">&lt;!-- web层 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">order</span>=<span class="string">"0"</span> <span class="attr">location</span>=<span class="string">"conf/wrefund-schedule.properties,conf/wrefund-service.properties,conf/waybill-refund-proxy.properties"</span>/&gt;</span></div></pre></td></tr></table></figure>
<h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><p><code>placeholders support for import</code><br>I’ve added such support for <code>system property</code> placeholders for import location</p>
<a href="https://jira.spring.io/browse/SPR-1332" title="placeholders support for import" target="_blank" rel="external">placeholders support for import</a>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-Dtest=<span class="built_in">test</span></div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"com/test/dao/dao-$&#123;test&#125;.xml"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="拷贝注解至Bean"><a href="#拷贝注解至Bean" class="headerlink" title="拷贝注解至Bean"></a>拷贝注解至Bean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">org.springframework.jmx.export.annotation.ManagedMetric ann =</div><div class="line">                AnnotationUtils.findAnnotation(method, org.springframework.jmx.export.annotation.ManagedMetric.class);</div><div class="line">        <span class="keyword">if</span> (ann == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        ManagedMetric managedMetric = <span class="keyword">new</span> ManagedMetric();</div><div class="line">        AnnotationBeanUtils.copyPropertiesToBean(ann, managedMetric);</div></pre></td></tr></table></figure>
<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>org.springframework.util.Assert</p>
<h2 id="xml解析"><a href="#xml解析" class="headerlink" title="xml解析"></a>xml解析</h2><p>org.springframework.util.xml.DomUtils#getChildElementValueByTagName</p>
<h2 id="获取原始类"><a href="#获取原始类" class="headerlink" title="获取原始类"></a>获取原始类</h2><p><code>cglib</code><br><code>代理前类</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Return the user-defined class for the given class: usually simply the given</div><div class="line"> * class, but the original class in case of a CGLIB-generated subclass.</div><div class="line"> */</div><div class="line">org.springframework.util.ClassUtils#getUserClass(java.lang.Class&lt;?&gt;)</div><div class="line"></div><div class="line">/**</div><div class="line"> * Determine the ultimate target class of the given bean instance</div><div class="line"> */</div><div class="line">org.springframework.aop.framework.AopProxyUtils#ultimateTargetClass(Object candidate)</div><div class="line"></div><div class="line">/**</div><div class="line"> * Determine the target class of the given bean instance which might be an AOP proxy.</div><div class="line"> */</div><div class="line">org.springframework.aop.support.AopUtils#getTargetClass(Object candidate)</div></pre></td></tr></table></figure>
<h2 id="合并map"><a href="#合并map" class="headerlink" title="合并map"></a>合并map</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"commonLookup"</span> </span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.MapFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sourceMap"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"myKey"</span> <span class="attr">value</span>=<span class="string">"142"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"myOtherKey"</span> <span class="attr">value</span>=<span class="string">"7"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myLookup"</span> <span class="attr">parent</span>=<span class="string">"commonLookup"</span> </span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.MapFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sourceMap"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">map</span> <span class="attr">merge</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"myLookupKey"</span> <span class="attr">value</span>=<span class="string">"12"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="工厂方法创建bean"><a href="#工厂方法创建bean" class="headerlink" title="工厂方法创建bean"></a>工厂方法创建bean</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"configurator"</span> <span class="attr">class</span>=<span class="string">"com.me.myapp.Configurator"</span> <span class="attr">factory-method</span>=<span class="string">"getInstance"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="静态字段创建bean"><a href="#静态字段创建bean" class="headerlink" title="静态字段创建bean"></a>静态字段创建bean</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"java.lang.Integer.MAX_VALUE"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"intMaxValue"</span></span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetClass"</span> <span class="attr">value</span>=<span class="string">"java.lang.Integer"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetField"</span> <span class="attr">value</span>=<span class="string">"MAX_VALUE"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="ResolvableType"><a href="#ResolvableType" class="headerlink" title="ResolvableType"></a>ResolvableType</h2><p>解析类型</p>
<p>Encapsulates a Java {@link java.lang.reflect.Type}, providing access to<br>{@link #getSuperType() supertypes}, {@link #getInterfaces() interfaces}</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取声明的事件类型-- 解析泛型类型</span></div><div class="line"><span class="function"><span class="keyword">static</span> ResolvableType <span class="title">resolveDeclaredEventType</span><span class="params">(Class&lt;?&gt; listenerType)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// Return this type as a &#123;@link ResolvableType&#125; of the specified class. Searches</span></div><div class="line">    <span class="comment">// &#123;@link #getSuperType() supertype&#125; and &#123;@link #getInterfaces() interface&#125;</span></div><div class="line">    ResolvableType resolvableType = ResolvableType.forClass(listenerType).as(ApplicationListener.class);</div><div class="line">    <span class="keyword">return</span> (resolvableType.hasGenerics() ? resolvableType.getGeneric() : <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Determine whether this &#123;@code ResolvableType&#125; is assignable from the specified other type.</span></div><div class="line"><span class="keyword">this</span>.declaredEventType == <span class="keyword">null</span> || <span class="keyword">this</span>.declaredEventType.isAssignableFrom(eventType)</div></pre></td></tr></table></figure>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 基于nnotationAwareOrderComparator排序</span></div><div class="line"><span class="comment">// supports Spring's &#123;@link org.springframework.core.Ordered&#125; interface </span></div><div class="line"><span class="comment">// as well as the &#123;@link Order @Order&#125; and &#123;@link javax.annotation.Priority @Priority&#125;</span></div><div class="line">AnnotationAwareOrderComparator.sort(allListeners);</div></pre></td></tr></table></figure>
<h2 id="Object类型转换"><a href="#Object类型转换" class="headerlink" title="Object类型转换"></a>Object类型转换</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Object 转 Array</span></div><div class="line"><span class="keyword">if</span> (result.getClass().isArray()) &#123;</div><div class="line">    Object[] events = ObjectUtils.toObjectArray(result);</div><div class="line">    <span class="keyword">for</span> (Object event : events) &#123;</div><div class="line">        publishEvent(event);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// Object 转 Collection</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (result <span class="keyword">instanceof</span> Collection&lt;?&gt;) &#123;</div><div class="line">    Collection&lt;?&gt; events = (Collection&lt;?&gt;) result;</div><div class="line">    <span class="keyword">for</span> (Object event : events) &#123;</div><div class="line">        publishEvent(event);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    publishEvent(result);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="AnnotatedTypeMetadata"><a href="#AnnotatedTypeMetadata" class="headerlink" title="AnnotatedTypeMetadata"></a>AnnotatedTypeMetadata</h2><p>获取注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">MultiValueMap&lt;String, Object&gt; attributes = metadata</div><div class="line">                .getAllAnnotationAttributes(annotationType.getName(), <span class="keyword">true</span>);</div><div class="line"><span class="keyword">if</span> (attributes == <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="MultiValueMap"><a href="#MultiValueMap" class="headerlink" title="MultiValueMap"></a>MultiValueMap</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MultiValueMap&lt;String, Object&gt; allAttributes = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</div></pre></td></tr></table></figure>
<h1 id="Spring-常识"><a href="#Spring-常识" class="headerlink" title="Spring 常识"></a>Spring 常识</h1><h2 id="获取全部bean"><a href="#获取全部bean" class="headerlink" title="获取全部bean"></a>获取全部bean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取bean数量</span></div><div class="line">Set&lt;String&gt; beanNames = <span class="keyword">new</span> LinkedHashSet&lt;String&gt;(<span class="keyword">this</span>.beanFactory.getBeanDefinitionCount());</div></pre></td></tr></table></figure>
<h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h2 id="解决Long转json精度丢失的问题"><a href="#解决Long转json精度丢失的问题" class="headerlink" title="解决Long转json精度丢失的问题"></a>解决Long转json精度丢失的问题</h2><p>Java Config配置方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.configureMessageConverters(converters);</div><div class="line">    <span class="comment">//1、定义一个convert转换消息的对象</span></div><div class="line">    FastJsonHttpMessageConverter fastConverter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</div><div class="line">    <span class="comment">//2、添加fastjson的配置信息</span></div><div class="line">    FastJsonConfig fastJsonConfig = <span class="keyword">new</span> FastJsonConfig();</div><div class="line"></div><div class="line">    fastJsonConfig.setCharset(Charset.forName(<span class="string">"UTF-8"</span>));</div><div class="line">    <span class="comment">/*</span></div><div class="line">    WriteNullListAsEmpty  ：List字段如果为null,输出为[],而非null</div><div class="line">    WriteNullStringAsEmpty ： 字符类型字段如果为null,输出为"",而非null</div><div class="line">    DisableCircularReferenceDetect ：消除对同一对象循环引用的问题，默认为false（如果不配置有可能会进入死循环）</div><div class="line">    WriteNullBooleanAsFalse：Boolean字段如果为null,输出为false,而非null</div><div class="line">    WriteMapNullValue：是否输出值为null的字段,默认为false</div><div class="line">     */</div><div class="line">    fastJsonConfig.setSerializerFeatures(</div><div class="line">            SerializerFeature.WriteNullListAsEmpty,</div><div class="line">            SerializerFeature.WriteNullStringAsEmpty,</div><div class="line">            SerializerFeature.DisableCircularReferenceDetect,</div><div class="line">            SerializerFeature.WriteNullBooleanAsFalse,</div><div class="line">            SerializerFeature.WriteMapNullValue,</div><div class="line">            SerializerFeature.WriteDateUseDateFormat</div><div class="line">    );</div><div class="line"></div><div class="line">    <span class="comment">//解决Long转json精度丢失的问题</span></div><div class="line">    SerializeConfig serializeConfig = SerializeConfig.globalInstance;</div><div class="line">    serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</div><div class="line">    serializeConfig.put(Long.class, ToStringSerializer.instance);</div><div class="line">    serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</div><div class="line">    fastJsonConfig.setSerializeConfig(serializeConfig);</div><div class="line">    <span class="comment">//3.在convert中添加配置信息</span></div><div class="line">    fastConverter.setFastJsonConfig(fastJsonConfig);</div><div class="line"></div><div class="line">    <span class="comment">//4.处理中文乱码问题</span></div><div class="line">    List&lt;MediaType&gt; fastMediaTypes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    fastMediaTypes.add(MediaType.TEXT_HTML);</div><div class="line">    fastMediaTypes.add(MediaType.APPLICATION_JSON_UTF8);</div><div class="line"></div><div class="line">    <span class="comment">//5.在convert中添加配置信息.</span></div><div class="line">    fastConverter.setSupportedMediaTypes(fastMediaTypes);</div><div class="line">    converters.add(fastConverter);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Xml配置方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * fastjson序列化配置</div><div class="line"> * <span class="doctag">@author</span> wangdianzhuang</div><div class="line"> * <span class="doctag">@create</span> 2018/8/29 上午 10:32</div><div class="line"> */</div><div class="line"><span class="meta">@Configuration</span>(<span class="string">"defaultFastjsonConfig"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultFastjsonConfig</span> </span>&#123;</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> SerializeConfig <span class="title">defaultSerializeConfig</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//解决Long转json精度丢失的问题</span></div><div class="line">        SerializeConfig serializeConfig = SerializeConfig.globalInstance;</div><div class="line">        serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</div><div class="line">        serializeConfig.put(Long.class, ToStringSerializer.instance);</div><div class="line">        serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</div><div class="line">        <span class="keyword">return</span> serializeConfig;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 开启mvc 注释驱动 扫描Controller中的注释--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 开启mvc 注释驱动 扫描Controller中的注释--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"conversionService"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- FastJson --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fastJsonHttpMessageConverter"</span></span></div><div class="line">              <span class="attr">class</span>=<span class="string">"com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter"</span>&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"supportedMediaTypes"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">                    <span class="comment">&lt;!-- 这里顺序不能反，一定先写text/html,不然ie下出现下载提示 --&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/html;charset=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>application/json;charset=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fastJsonConfig"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.alibaba.fastjson.support.config.FastJsonConfig"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"charset"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>/&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"serializeConfig"</span> <span class="attr">ref</span>=<span class="string">"defaultSerializeConfig"</span>/&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"serializerFeatures"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">array</span>&gt;</span></div><div class="line">                            <span class="comment">&lt;!-- 避免循环引用 --&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"com.alibaba.fastjson.serializer.SerializerFeature.DisableCircularReferenceDetect"</span>/&gt;</span></div><div class="line">                            <span class="comment">&lt;!-- 是否输出值为null的字段 --&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"com.alibaba.fastjson.serializer.SerializerFeature.WriteMapNullValue"</span>/&gt;</span></div><div class="line">                            <span class="comment">&lt;!-- Boolean字段如果为null,输出为false,而非null --&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"com.alibaba.fastjson.serializer.SerializerFeature.WriteNullBooleanAsFalse"</span>/&gt;</span></div><div class="line">                            <span class="comment">&lt;!-- List字段如果为null,输出为[],而非null --&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"com.alibaba.fastjson.serializer.SerializerFeature.WriteNullListAsEmpty"</span>/&gt;</span></div><div class="line">                            <span class="comment">&lt;!-- 数值字段如果为null,输出为0,而非null --&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"com.alibaba.fastjson.serializer.SerializerFeature.WriteNullNumberAsZero"</span>/&gt;</span></div><div class="line">                            <span class="comment">&lt;!-- 字符类型字段如果为null,输出为"",而非null --&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"com.alibaba.fastjson.serializer.SerializerFeature.WriteNullStringAsEmpty"</span>/&gt;</span></div><div class="line">                            <span class="comment">&lt;!-- Data格式化输出 --&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"com.alibaba.fastjson.serializer.SerializerFeature.WriteDateUseDateFormat"</span>/&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>mvc:annotation-driven 对父容器中</p>
</blockquote>
<h2 id="请求空串转为null"><a href="#请求空串转为null" class="headerlink" title="请求空串转为null"></a>请求空串转为null</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">binder.registerCustomEditor(String.class, <span class="keyword">new</span> StringTrimmerEditor(<span class="keyword">true</span>));</div><div class="line">binder.registerCustomEditor(Boolean.class, <span class="keyword">new</span> CustomBooleanEditor(<span class="keyword">true</span>));</div></pre></td></tr></table></figure>
<h2 id="Response-1"><a href="#Response-1" class="headerlink" title="Response"></a>Response</h2><p><code>@ResponseBody</code> The return value is converted through HttpMessageConverter instances and written to the response.<br><code>ResponseEntity&lt;B&gt;</code> ResponseEntity is like @ResponseBody but with status and headers.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GetMapping</span>(<span class="string">"/something"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">handle</span><span class="params">()</span> </span>&#123;</div><div class="line">    String body = ... ;</div><div class="line">    String etag = ... ;</div><div class="line">    <span class="keyword">return</span> ResponseEntity.ok().eTag(etag).build(body);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>HttpEntity<b> For access to request headers and body. The body is converted with an HttpMessageConverter</b></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@PostMapping</span>(<span class="string">"/accounts"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpEntity&lt;Account&gt; entity)</span> </span>&#123;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 存活检查</span></div><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/health"</span>, method = RequestMethod.GET)</div><div class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">health</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity(<span class="string">"alive"</span>,HttpStatus.OK);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="获取request"><a href="#获取request" class="headerlink" title="获取request"></a>获取request</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- spring --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.request.RequestContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// spring boot</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LestoreWebOutsideInitializer</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> application.sources(LestoreWebOutsideApplication.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onStartup(servletContext);</div><div class="line">        servletContext.addListener(<span class="keyword">new</span> RequestContextListener());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">HttpServletRequest req = ((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getRequest();</div><div class="line">HttpServletResponse resp = ((ServletWebRequest)RequestContextHolder.getRequestAttributes()).getResponse();</div></pre></td></tr></table></figure>
<h2 id="SpringMVC-Annotation"><a href="#SpringMVC-Annotation" class="headerlink" title="SpringMVC Annotation"></a>SpringMVC Annotation</h2><ul>
<li>@RequestParam：Annotation which indicates that a method parameter should be bound to a web request parameter</li>
<li>@SessionAttributes：Annotation that indicates the session attributes that a specific handler uses</li>
</ul>
<h2 id="SpringMVC-Solutions"><a href="#SpringMVC-Solutions" class="headerlink" title="SpringMVC Solutions"></a>SpringMVC Solutions</h2><h3 id="Error-creating-bean-with-name-‘org-springframework-validation-beanvalidation-LocalValidatorFactoryBean-0’"><a href="#Error-creating-bean-with-name-‘org-springframework-validation-beanvalidation-LocalValidatorFactoryBean-0’" class="headerlink" title="Error creating bean with name ‘org.springframework.validation.beanvalidation.LocalValidatorFactoryBean#0’"></a>Error creating bean with name ‘org.springframework.validation.beanvalidation.LocalValidatorFactoryBean#0’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Caused by: javax.validation.ValidationException: Unable to create a Configuration, because no Bean Validation provider could be found. <span class="function">Add a provider like Hibernate <span class="title">Validator</span> <span class="params">(RI)</span> to your classpath.</span></div><div class="line">    at javax.validation.Validation$GenericBootstrapImpl.<span class="title">configure</span><span class="params">(Validation.java:<span class="number">271</span>)</span></div><div class="line">    at org.springframework.validation.beanvalidation.LocalValidatorFactoryBean.<span class="title">afterPropertiesSet</span><span class="params">(LocalValidatorFactoryBean.java:<span class="number">191</span>)</span></div><div class="line">    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.<span class="title">invokeInitMethods</span><span class="params">(AbstractAutowireCapableBeanFactory.java:<span class="number">1573</span>)</span></div><div class="line">    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.<span class="title">initializeBean</span><span class="params">(AbstractAutowireCapableBeanFactory.java:<span class="number">1511</span>)</span></div></pre></td></tr></table></figure>
<p>原因：依赖中引入javax.validation:validation-api:jar:1.1.0.Final，spring自动初始化LocalValidatorFactoryBean<br>解决：添加依赖org.hibernate:hibernate-validator:jar:4.3.2.Final</p>
<h1 id="Spring-IOC"><a href="#Spring-IOC" class="headerlink" title="Spring IOC"></a>Spring IOC</h1><h2 id="Aware"><a href="#Aware" class="headerlink" title="Aware"></a>Aware</h2><p>BeanNameAware</p>
<blockquote>
<p>Interface to be implemented by beans that want to be aware of their bean name in a bean factory</p>
</blockquote>
<h2 id="父子容器"><a href="#父子容器" class="headerlink" title="父子容器"></a>父子容器</h2><p>父容器仅仅是 bean（对象） 对子容器可见，加载的全局变量仍然相互独</p>
<h3 id="重复AOP"><a href="#重复AOP" class="headerlink" title="重复AOP"></a>重复AOP</h3><blockquote>
<p>DespatcherServlet 加载spring-empty.xml 或者 spring-mvc.xml，aop在父容器中配置，不会有这个问题</p>
</blockquote>
<p>InfrastructureAdvisorAutoProxyCreator 与 AspectJAwareAdvisorAutoProxyCreator</p>
<p>tx命名空间会注册InfrastructureAdvisorAutoProxyCreator<br>aop</p>
<h2 id="BeanFactory和ApplicationContext"><a href="#BeanFactory和ApplicationContext" class="headerlink" title="BeanFactory和ApplicationContext"></a>BeanFactory和ApplicationContext</h2><p>Spring通过配置文件描述Bean之前的依赖关系，利用java<code>反射</code>实例化Bean并建立Bean之间的依赖关系。</p>
<h2 id="WebApplicationContext"><a href="#WebApplicationContext" class="headerlink" title="WebApplicationContext"></a>WebApplicationContext</h2><p>WebApplicationContext必须在拥有web容器的前提下才能完成启动的工作。<br>xml中配置自启动Servlet或ServletContextListenter完成启动Spring Web应用上下文。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// configLocations 中可包含系统变量</span></div><div class="line">ClassPathXmlApplicationContext pFactory = <span class="keyword">new</span> ClassPathXmlApplicationContext(</div><div class="line">                <span class="keyword">new</span> String[]&#123;<span class="string">"com/smart/attr/beans1.xml"</span>&#125;);</div><div class="line"><span class="comment">// 子容器</span></div><div class="line">ApplicationContext factory = <span class="keyword">new</span> ClassPathXmlApplicationContext(</div><div class="line"><span class="keyword">new</span> String[]&#123;<span class="string">"com/smart/attr/beans2.xml"</span>&#125;,pFactory);</div></pre></td></tr></table></figure>
<p><code>ContextLoaderListener</code>通过Web容器上下文参数<code>contextConfigLocation</code>获取Spring配置文件位置。<br>可指定多个配置文件，用逗号、空格或分号分隔。</p>
<p>DispatcherServlet是一个Servlet,<code>可同时配置多个</code>，<br>每个 DispatcherServlet有一个自己的 WebApplicationContext上下文，这个上下文继承了 <code>根上下文</code> 中所有东西。</p>
<p>使用工具类取出上下文：<br>WebApplicationContextUtils.getWebApplicationContext(ServletContext);<br>RequestContextUtils.getWebApplicationContext(request);</p>
<p>可不使用listener监听器来加载spring的配置，改用DispatcherServlet来加载spring的配置，不要双亲上下文，只使用一个DispatcherServlet</p>
<h2 id="Bean命名"><a href="#Bean命名" class="headerlink" title="Bean命名"></a>Bean命名</h2><p>id命名规范：字母开头，后面字母、数字、连字符、下划线、句号、冒号；<br>name命名没有字符限制；<br>id是<code>标识符</code>，name是<code>别名</code>；</p>
<p>id 和 name都可以指定多个，以逗号、分号或空格分隔；<br>id 必须唯一；同名name，后面Bean<code>覆盖</code>前面同名的Bean；<br>为了避免无意间Bean覆盖的隐患，<code>尽量使用id而非name命名Bean</code>。</p>
<p>如果id和name都未指定，Spring自动将<code>完全限定名</code>作为Bean的名称。<br>完全限定名相同的多个未命名bean加#i后缀</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- com.smart.ditype.Car --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.smart.ditype.Car"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- com.smart.ditype.Car#1 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.smart.ditype.Car"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 两种别名方式 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.smart.ditype.Bar"</span> <span class="attr">id</span>=<span class="string">"bar"</span> <span class="attr">name</span>=<span class="string">"barA,barB"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">"bar"</span> <span class="attr">alias</span>=<span class="string">"barC"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="工厂方法"><a href="#工厂方法" class="headerlink" title="工厂方法"></a>工厂方法</h2><p><code>FactoryBean</code></p>
<ul>
<li>使用FactoryBean：从BeanFactory中获取的实际上是FactoryBean的getObject()返回的对象，而不是FactoryBean本身</li>
<li>调用工厂方法</li>
<li>访问静态字段</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"employee"</span> <span class="attr">class</span>=<span class="string">"com.javainterviewpoint.springfactory.EmployeeFactory"</span> </span></div><div class="line">   <span class="attr">factory-method</span>=<span class="string">"createEmployee"</span>&gt; </div><div class="line"> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"> </div><div class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"manager"</span> <span class="attr">class</span>=<span class="string">"com.javainterviewpoint.springfactory.Employee"</span></span></div><div class="line">    <span class="attr">factory-bean</span> =<span class="string">"employee"</span> <span class="attr">factory-method</span>=<span class="string">"getManager"</span>/&gt;</div><div class="line"> </div><div class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"seniormanager"</span> </span></div><div class="line">    <span class="attr">factory-bean</span> =<span class="string">"employee"</span> <span class="attr">factory-method</span>=<span class="string">"getSeniorManager"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"exposeBeanNameAdvisors"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.interceptor.ExposeBeanNameAdvisors"</span> <span class="attr">factory-method</span>=<span class="string">"createAdvisorIntroducingNamedBean"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"fooService"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">util:constant</span> <span class="attr">static-field</span>=<span class="string">"java.lang.Integer.MAX_VALUE"</span> /&gt;</span></div><div class="line"> </div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"intMaxValue"</span></span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetClass"</span> <span class="attr">value</span>=<span class="string">"java.lang.Integer"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetField"</span> <span class="attr">value</span>=<span class="string">"MAX_VALUE"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="动态注册Bean"><a href="#动态注册Bean" class="headerlink" title="动态注册Bean"></a>动态注册Bean</h2><p><code>org.mybatis.spring.mapper.MapperScannerConfigurer</code></p>
<h2 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h2><p>一般java属性名以小写字母开头，<br>JavaBean允许大写字母开头的属性变量名，不过必须满足<code>变量的前两个字母要么全部大写，要么全部小写</code></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>context:annotation-config</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 作用是向 Spring 容器注册 AutowiredAnnotationBeanPostProcessor、CommonAnnotationBeanPostProcessor、</span></div><div class="line">PersistenceAnnotationBeanPostProcessor 以及 RequiredAnnotationBeanPostProcessor 这 4 个BeanPostProcessor</div><div class="line">注册这4个BeanPostProcessor的作用是使系统能够识别相应的注解--&gt;</div><div class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 包扫描配置也包含了自动注入上述processor的功能，因此当使用 &lt;context:component-scan/&gt; 后，可以将 &lt;context:annotation-config/&gt; 移除。 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"XX.XX"</span>/&gt;</span> </div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"x.y.z.service, x.y.z.controller"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h3 id="自动注入"><a href="#自动注入" class="headerlink" title="自动注入"></a>自动注入</h3><p><code>自动注入</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">    <span class="attr">default-lazy-init</span>=<span class="string">"false"</span> <span class="attr">default-autowire</span>=<span class="string">"byName"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<p>default-autowire：根据属性名自动装配<br>根据名字查找与属性完全一致的bean，并将其与属性自动装配</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.apache.ibatis.session.Configuration"</span> <span class="attr">autowire</span>=<span class="string">"no"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Bean维度取消自动注入"><a href="#Bean维度取消自动注入" class="headerlink" title="Bean维度取消自动注入"></a>Bean维度取消自动注入</h3><p><code>取消自动注入</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"autowireTest1"</span> <span class="attr">autowire</span>=<span class="string">"no"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="xml注入map"><a href="#xml注入map" class="headerlink" title="xml注入map"></a>xml注入map</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">"waybillTaskDaoMap"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"waybill_sync_task"</span> <span class="attr">value-ref</span>=<span class="string">"waybillSyncTaskDao"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"waybill_sync0_task"</span> <span class="attr">value-ref</span>=<span class="string">"waybillSync0TaskDao"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">"waybillSyncTaskTypes"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"doWaybillSync0TaskRedis"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"doWaybillSync1TaskRedis"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"callbackServiceList"</span> <span class="attr">list-class</span>=<span class="string">"java.util.ArrayList"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"lspDeliveryCallback"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"lspRefuseCallback"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"lspPsyShCallback"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"waybillStateToPd"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"waybillTradeToYiXun"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"waybillTradeToCarService"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="构造器注入"><a href="#构造器注入" class="headerlink" title="构造器注入"></a>构造器注入</h3><p>按类型匹配入参</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--构造函数注入：type --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car1"</span> <span class="attr">class</span>=<span class="string">"com.smart.ditype.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>红旗CA72<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"double"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>20000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>按索引匹配入参</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 构造函数注入：index  --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car2"</span> <span class="attr">class</span>=<span class="string">"com.smart.ditype.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"红旗CA72"</span> /&gt;</span> </div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"中国一汽"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">value</span>=<span class="string">"20000"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>联合使用类型和索引</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--构造函数注入：type&amp;index --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car3"</span> <span class="attr">class</span>=<span class="string">"com.smart.ditype.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>红旗CA72<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>中国一汽<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>没设置type和index</code>,通过入参值的类型匹配映射</p>
<p>循环依赖问题，将<code>构造函数注入</code>调整为<code>属性注入方式</code>即可</p>
<h3 id="注入参数"><a href="#注入参数" class="headerlink" title="注入参数"></a>注入参数</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boss1"</span> <span class="attr">class</span>=<span class="string">"com.smart.ditype.Boss"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"car"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">local</span>=<span class="string">"car"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">parent</span>=<span class="string">"office"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p><ref> 3种方式引用Bean：<br>bean同一容器或父容器的Bean；<br>local同一配置文件中的Bean；<br>parent引用父容器中的Bean；</ref></p>
<h3 id="集合类型属性"><a href="#集合类型属性" class="headerlink" title="集合类型属性"></a>集合类型属性</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boss1"</span> <span class="attr">class</span>=<span class="string">"com.smart.attr.Boss"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"favorites"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- list&gt;</span></div><div class="line">            &lt;value&gt;看报&lt;/value&gt;</div><div class="line">            &lt;/list --&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>看报<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"stage1"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobs"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>AM<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>会见客户<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>PM<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>公司内部会议<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mails"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- Properties属性配置 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"jobMail"</span>&gt;</span>john-office@baobaotao.com<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"lifeMail"</span>&gt;</span>john-life@baobaotao.com<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobTime"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>会见客户<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>124<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="通过util命名空间配置集合类型Bean"><a href="#通过util命名空间配置集合类型Bean" class="headerlink" title="通过util命名空间配置集合类型Bean"></a>通过util命名空间配置集合类型Bean</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"favoriteList1"</span> <span class="attr">list-class</span>=<span class="string">"java.util.LinkedList"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>看报<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>赛车<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>高尔夫<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">util:set</span> <span class="attr">id</span>=<span class="string">"favoriteSet1"</span>  &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>看报<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>赛车<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>高尔夫<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">util:set</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">"emails1"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"AM"</span> <span class="attr">value</span>=<span class="string">"会见客户"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"PM"</span> <span class="attr">value</span>=<span class="string">"公司内部会议"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emails"</span></span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.MapFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sourceMap"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"AM"</span> <span class="attr">value</span>=<span class="string">"会见客户"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"PM"</span> <span class="attr">value</span>=<span class="string">"公司内部会议"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emailProps"</span></span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertiesFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"location"</span></span></div><div class="line">        <span class="attr">value</span>=<span class="string">"classpath:com/smart/fb/mails.properties"</span>&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">util:properties</span> <span class="attr">id</span>=<span class="string">"emailProps1"</span> <span class="attr">location</span>=<span class="string">"classpath:com/smart/fb/mails.properties"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>获取类的静态变量:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car2"</span> <span class="attr">class</span>=<span class="string">"com.smart.fb.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brand"</span> <span class="attr">ref</span>=<span class="string">"hongQi"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 获取类的静态变量 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"hongQi"</span></span></div><div class="line">    <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"staticField"</span></span></div><div class="line">        <span class="attr">value</span>=<span class="string">"com.smart.fb.CarBrandType.HONG_QI"</span>&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car3"</span> <span class="attr">class</span>=<span class="string">"com.smart.fb.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brand"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 用常量的全限定名作为FieldRetrievingFactoryBean的id，其效果和通过配置staticField属性是一样的 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"com.smart.fb.CarBrandType.HONG_QI"</span></span></div><div class="line">            <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span>&gt;</div><div class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car4"</span> <span class="attr">class</span>=<span class="string">"com.smart.fb.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brand"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 使用常量配置 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">util:constant</span></span></div><div class="line">            <span class="attr">static-field</span>=<span class="string">"com.smart.fb.CarBrandType.HONG_QI"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>属性路径引用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 属性引用FactoryBean:属性路径引用 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boss"</span> <span class="attr">class</span>=<span class="string">"com.smart.fb.Boss"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"John"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.smart.fb.Car"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brand"</span> <span class="attr">value</span>=<span class="string">"红旗CA72"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car5"</span> <span class="attr">class</span>=<span class="string">"com.smart.fb.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brand"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"boss.car.brand"</span></span></div><div class="line">            <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPathFactoryBean"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car6"</span> <span class="attr">class</span>=<span class="string">"com.smart.fb.Car"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brand"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">util:property-path</span> <span class="attr">path</span>=<span class="string">"boss.car.brand"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p><code>相同配置</code><br><code>通用配置</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"abstractTaskConfig1"</span> <span class="attr">abstract</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"com.jd.ql.waybill.schedule.config.TaskConfig"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"refIdEx"</span> <span class="attr">value</span>=<span class="string">"$.waybillCode"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"taskTypeNum"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"entityType"</span> <span class="attr">value</span>=<span class="string">"com.jd.ql.waybill.schedule.sample.Waybill"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"workerLogic"</span> <span class="attr">ref</span>=<span class="string">"waybillWorkerLogic"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"taskDesc"</span> <span class="attr">value</span>=<span class="string">"Tb异步任务示例"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"tbTaskConfig1"</span> <span class="attr">parent</span>=<span class="string">"abstractTaskConfig1"</span> <span class="attr">class</span>=<span class="string">"com.jd.ql.waybill.schedule.config.TbTaskConfig"</span> <span class="attr">depends-on</span>=<span class="string">"commonDbTaskDao"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"taskTypeKey"</span> <span class="attr">value</span>=<span class="string">"doSampleTask"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"queueCount"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxExecuteCount"</span> <span class="attr">value</span>=<span class="string">"4"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"intervalMin"</span> <span class="attr">value</span>=<span class="string">"10"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dbTaskDao"</span> <span class="attr">ref</span>=<span class="string">"commonDbTaskDao"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"taskType"</span> <span class="attr">value</span>=<span class="string">"com.jd.ql.waybill.schedule.domain.CommonDbTask"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmqTaskConfig1"</span> <span class="attr">parent</span>=<span class="string">"abstractTaskConfig1"</span> <span class="attr">class</span>=<span class="string">"com.jd.ql.waybill.schedule.config.JmqTaskConfig"</span> <span class="attr">depends-on</span>=<span class="string">"waybillDevTestProducer"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"topicName"</span> <span class="attr">value</span>=<span class="string">"test_waybill_schedule"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageProducer"</span> <span class="attr">ref</span>=<span class="string">"waybillDevTestProducer"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"taskType"</span> <span class="attr">value</span>=<span class="string">"com.jd.ql.waybill.schedule.domain.CommonTask"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="运行时注入-属性占位符"><a href="#运行时注入-属性占位符" class="headerlink" title="运行时注入-属性占位符"></a>运行时注入-属性占位符</h3><p>TODO</p>
<h3 id="运行时注入-Spring表达式语言-SpEL"><a href="#运行时注入-Spring表达式语言-SpEL" class="headerlink" title="运行时注入-Spring表达式语言(SpEL)"></a>运行时注入-Spring表达式语言(SpEL)</h3><p>TODO</p>
<h2 id="Bean作用域"><a href="#Bean作用域" class="headerlink" title="Bean作用域"></a>Bean作用域</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.xxc.scope.domain.Person"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>singleton: 单例</li>
<li><p>prototype: 每次getBean() 返回新实例</p>
</li>
<li><p>request: 仅web应用中</p>
</li>
<li>session: 仅web应用中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// proxyMode 解决request域或Session域bean注入单例bean中遇到的问题</span></div><div class="line"><span class="comment">// 1. StoreService是单例的，StoreService在spring上下文加载时创建；此时注入shoppingCart，但shoppingCart还不存在；</span></div><div class="line"><span class="comment">// 2. StoreService中注入的shoppingCart不应该是固定的，而是每个用户一个；</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreService</span> </span>&#123;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShoppingCart</span><span class="params">(ShoppingCart shoppingCart)</span></span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 配置proxyMode，spring 不会讲实际的ShoppingCart注入到StoreService中，而是注入一个ShoppingCart的代理</span></div><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="meta">@Scope</span>(scopeName=<span class="string">"session"</span>, proxyMode=ScopedProxyMode.TARGET_CLASS)</div><div class="line"><span class="function">ShoppingCart <span class="title">shoppingCart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ShoppingCart();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shoppingCart"</span> <span class="attr">class</span>=<span class="string">"com.foo.ShoppingCart"</span> <span class="attr">scope</span>=<span class="string">"session"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">aop:scoped-proxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="校验Bean成员变量是否设置"><a href="#校验Bean成员变量是否设置" class="headerlink" title="校验Bean成员变量是否设置"></a>校验Bean成员变量是否设置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"CustomerBean"</span> <span class="attr">class</span>=<span class="string">"com.mkyong.common.Customer"</span> </span></div><div class="line">     <span class="attr">dependency-check</span>=<span class="string">"simple"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"person"</span> <span class="attr">ref</span>=<span class="string">"PersonBean"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"action"</span> <span class="attr">value</span>=<span class="string">"buy"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"CustomerBean"</span> <span class="attr">class</span>=<span class="string">"com.mkyong.common.Customer"</span> </span></div><div class="line">     <span class="attr">dependency-check</span>=<span class="string">"objects"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"action"</span> <span class="attr">value</span>=<span class="string">"buy"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"type"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"CustomerBean"</span> <span class="attr">class</span>=<span class="string">"com.mkyong.common.Customer"</span> </span></div><div class="line">     <span class="attr">dependency-check</span>=<span class="string">"all"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"action"</span> <span class="attr">value</span>=<span class="string">"buy"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="meta元素"><a href="#meta元素" class="headerlink" title="meta元素"></a>meta元素</h2><p>Bean可配置额外的meta声明;可通过BeanDefinition的getAttribute(key)获取</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"footmark.HelloWorld"</span>&gt;</span> </div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"DVD"</span>/&gt;</span> </div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">"genre"</span> <span class="attr">value</span>=<span class="string">"Action"</span>/&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="lookup-method"><a href="#lookup-method" class="headerlink" title="lookup-method"></a>lookup-method</h2><ul>
<li>spring动态改变bean方法返回的对象</li>
<li>Bean类型可为抽象类（Spring使用cglib实现）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bar"</span> <span class="attr">class</span>=<span class="string">"com.sunday.common.domain.Bar"</span> <span class="attr">p:name</span>=<span class="string">"lookup-methond-demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">class</span>=<span class="string">"com.sunday.spring3_learn.api.impl.BarServiceImpl"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">lookup-method</span> <span class="attr">name</span>=<span class="string">"queryBar"</span> <span class="attr">bean</span>=<span class="string">"bar"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="replaced-method"><a href="#replaced-method" class="headerlink" title="replaced-method"></a>replaced-method</h2><p>动态更改原方法的逻辑</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myValueCalculator"</span> <span class="attr">class</span>=<span class="string">"x.y.z.MyValueCalculator"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- arbitrary method replacement --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">replaced-method</span> <span class="attr">name</span>=<span class="string">"computeValue"</span> <span class="attr">replacer</span>=<span class="string">"replacementComputeValue"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">arg-type</span>&gt;</span>String<span class="tag">&lt;/<span class="name">arg-type</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">replaced-method</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="注入静态字段"><a href="#注入静态字段" class="headerlink" title="注入静态字段"></a>注入静态字段</h2><p><code>static</code><br><code>静态</code></p>
<p>Spring Bean赋值给静态字段 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.MethodInvokingFactoryBean"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"staticMethod"</span> <span class="attr">value</span>=<span class="string">"foo.bar.Class.setTheProperty"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arguments"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"theProperty"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h2><p><code>beanFactory java config</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span>(name = <span class="string">"tool"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> ToolFactory <span class="title">toolFactory</span><span class="params">()</span> </span>&#123;</div><div class="line">    ToolFactory factory = <span class="keyword">new</span> ToolFactory();</div><div class="line">    factory.setFactoryId(<span class="number">7070</span>);</div><div class="line">    factory.setToolId(<span class="number">2</span>);</div><div class="line">    <span class="keyword">return</span> factory;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="DataSource"><a href="#DataSource" class="headerlink" title="DataSource"></a>DataSource</h2><p><code>dbcp</code><br><code>datasource</code><br><code>javaconfig</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span>(destroyMethod = <span class="string">"close"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</div><div class="line">    BasicDataSource dataSource = <span class="keyword">new</span> BasicDataSource();</div><div class="line">    dataSource.setDriverClassName(driverClassName);</div><div class="line">    dataSource.setUrl(databaseUrl);</div><div class="line">    dataSource.setUsername(databaseUserName);</div><div class="line">    dataSource.setPassword(databasePassword);</div><div class="line">    dataSource.setValidationQuery(databaseValidationQuery);</div><div class="line">    dataSource.setTestOnBorrow(<span class="keyword">true</span>);</div><div class="line">    dataSource.setTestOnReturn(<span class="keyword">true</span>);</div><div class="line">    dataSource.setTestWhileIdle(<span class="keyword">true</span>);</div><div class="line">    dataSource.setTimeBetweenEvictionRunsMillis(<span class="number">1800000</span>);</div><div class="line">    dataSource.setNumTestsPerEvictionRun(<span class="number">3</span>);</div><div class="line">    dataSource.setMinEvictableIdleTimeMillis(<span class="number">1800000</span>);</div><div class="line">    <span class="keyword">return</span> dataSource;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h2><p>按名称进行装配，名称可以通过name属性指定，<br>没有指定name属性，当注解写在字段上时，默认取字段名</p>
<p>@Resource默认是按照名称来装配注入的，当找不到与名称匹配的bean，按照类型来装配注入</p>
<h2 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h2><p>默认是按照类型进行装配注入<br>默认要求依赖对象必须存在，可以设置required</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Target</span>(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.ANNOTATION_TYPE&#125;)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Primary"><a href="#Primary" class="headerlink" title="@Primary"></a>@Primary</h2><p><code>包含多个相同类型Bean场景</code></p>
<p>使用<code>@Autowire</code>d注入时会首先使用被标记为<code>@Primary</code>的Bean</p>
<h2 id="Qualifier"><a href="#Qualifier" class="headerlink" title="Qualifier"></a>Qualifier</h2><p>@Qualifier is used to reference a bean by its name or id. </p>
<p>@Primary is also good if e.g. 95% of @Autowired wants a particular bean. That way,<br>only the @Autowired that wants the other bean(s) need to specify @Qualifier.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line"><span class="meta">@Qualifier</span>(<span class="string">"main"</span>)</div><div class="line"><span class="keyword">private</span> MovieCatalog movieCatalog;</div></pre></td></tr></table></figure>
<h2 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h2><p><code>条件化配置</code></p>
<p><code>Spring 3.1</code>引入，基于运行时激活的Profile，会使用或者忽略不同的Bean或配置类</p>
<p>两个配置项确定Profile<br>spring.profiles.default<br>spring.profiles.active</p>
<p>没有配置spring.profiles.active时，Spring会查找spring.profiles.default的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@Profile</span>(<span class="string">"production"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductionConfiguration</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Profile</span>(<span class="string">"dev"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DevDatasourceConfig</span></span>;</div><div class="line"></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Profile</span>(<span class="string">"!dev"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DevDatasourceConfig</span></span>;</div><div class="line"></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Profile</span>(<span class="string">"dev"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DevDatasourceConfig</span> <span class="keyword">implements</span> <span class="title">DatasourceConfig</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Setting up datasource for DEV environment. "</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"dev"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"devDatasourceConfig"</span></span></div><div class="line">      <span class="attr">class</span>=<span class="string">"org.baeldung.profiles.DevDatasourceConfig"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Set-Profiles"><a href="#Set-Profiles" class="headerlink" title="Set Profiles"></a>Set Profiles</h3><p>Context Parameter in web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/app-config.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>spring.profiles.active<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div></pre></td></tr></table></figure>
<p>WebApplicationInitializer interface</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebApplicationInitializer</span> </span></div><div class="line">  <span class="keyword">implements</span> <span class="title">WebApplicationInitializer</span> &#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">  </div><div class="line">        servletContext.setInitParameter(</div><div class="line">          <span class="string">"spring.profiles.active"</span>, <span class="string">"dev"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ConfigurableEnvironment</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line"><span class="keyword">private</span> ConfigurableEnvironment env;</div><div class="line">env.setActiveProfiles(<span class="string">"someProfile"</span>);</div></pre></td></tr></table></figure>
<p>JVM System Parameter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export spring_profiles_active=dev</div></pre></td></tr></table></figure>
<p>Maven Profile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Spring 支持application.properties或application.yml 中配置profile</div><div class="line"># application.properties</div><div class="line">spring.profiles.active=@spring.profiles.active@</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div></pre></td></tr></table></figure>
<p>we need to enable resource filtering in pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<p>@ActiveProfile in Tests</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"dev"</span>)</div></pre></td></tr></table></figure>
<h3 id="Get-Active-Profiles"><a href="#Get-Active-Profiles" class="headerlink" title="Get Active Profiles"></a>Get Active Profiles</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProfileManager</span> </span>&#123;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    Environment environment;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getActiveProfiles</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">final</span> String profileName : environment.getActiveProfiles()) &#123;</div><div class="line">            System.out.println(<span class="string">"Currently active profile - "</span> + profileName);</div><div class="line">        &#125;   </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="条件化配置"><a href="#条件化配置" class="headerlink" title="条件化配置"></a>条件化配置</h2><p><code>Spring 4.0</code><br>配置存在于应用中，在满足特定条件之前都忽略这个配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTemplateCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext context,</span></span></div><div class="line">            AnnotatedTypeMetadata metadata) &#123;</div><div class="line">        <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</div><div class="line">            classLoader = ClassUtils.getDefaultClassLoader();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            forName(<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>, classLoader);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className, ClassLoader classLoader)</div><div class="line">                <span class="keyword">throws</span> ClassNotFoundException &#123;</div><div class="line">        <span class="keyword">if</span> (classLoader != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> classLoader.loadClass(className);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> Class.forName(className);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 只有当JdbcTemplateCondition类条件成立时，才会创建MyService</span></div><div class="line"><span class="meta">@Conditional</span>(JdbcTemplateCondition.class)</div><div class="line"><span class="keyword">public</span> MyService myService&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="获取bean"><a href="#获取bean" class="headerlink" title="获取bean"></a>获取bean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, CustomConverter&gt; contextConverters = applicationContext.getBeansOfType(CustomConverter.class);</div></pre></td></tr></table></figure>
<h2 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h2><p><code>alias</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"b1"</span> <span class="attr">class</span>=<span class="string">"com.wengyingjian.springframework.test.aliassamesname.Bean1"</span> <span class="attr">name</span>=<span class="string">"bean1"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"b2"</span> <span class="attr">class</span>=<span class="string">"com.wengyingjian.springframework.test.aliassamesname.Bean2"</span> <span class="attr">name</span>=<span class="string">"bean2"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">"bean1"</span> <span class="attr">alias</span>=<span class="string">"bean2"</span>/&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h2><p>spring中有作用域scope的概念。<br>除了singleton、prototype、request、session等spring为我们提供的域，我们还可以自定义scope。</p>
<p>像是自定义一个 ThreadScope实现Scope接口<br>再把它注册到beanFactory中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Scope threadScope = <span class="keyword">new</span> ThreadScope();</div><div class="line">beanFactory.registerScope(<span class="string">"thread"</span>, threadScope);</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"..."</span> <span class="attr">class</span>=<span class="string">"..."</span> <span class="attr">scope</span>=<span class="string">"thread"</span>/&gt;</span></div></pre></td></tr></table></figure>
<h2 id="BeanFactoryPostProcessor"><a href="#BeanFactoryPostProcessor" class="headerlink" title="BeanFactoryPostProcessor"></a>BeanFactoryPostProcessor</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Modify the application context's internal bean factory after its standard</div><div class="line">     * initialization. All bean definitions will have been loaded, but no beans</div><div class="line">     * will have been instantiated yet. This allows for overriding or adding</div><div class="line">     * properties even to eager-initializing beans.</div><div class="line">     * <span class="doctag">@param</span> beanFactory the bean factory used by the application context</div><div class="line">     * <span class="doctag">@throws</span> org.springframework.beans.BeansException in case of errors</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Role"><a href="#Role" class="headerlink" title="@Role"></a>@Role</h2><ul>
<li>BeanDefinition#ROLE_APPLICATION：a user-defined bean</li>
<li>BeanDefinition#ROLE_SUPPORT：a supporting part of some larger configuration</li>
<li>BeanDefinition#ROLE_INFRASTRUCTURE：entirely background role and has no relevance to the end-user</li>
</ul>
<h2 id="AutoProxyRegistrar"><a href="#AutoProxyRegistrar" class="headerlink" title="AutoProxyRegistrar"></a>AutoProxyRegistrar</h2><p><code>org.springframework.context.annotation.AutoProxyRegistrar</code></p>
<p>Registers an auto proxy creator against the current {@link BeanDefinitionRegistry}</p>
<h2 id="ImportBeanDefinitionRegistrar"><a href="#ImportBeanDefinitionRegistrar" class="headerlink" title="ImportBeanDefinitionRegistrar"></a>ImportBeanDefinitionRegistrar</h2><p>Interface to be implemented by types that register additional bean definitions when</p>
<ul>
<li>processing @{@link Configuration} classes.</li>
</ul>
<h1 id="AnnotationMetadata"><a href="#AnnotationMetadata" class="headerlink" title="AnnotationMetadata"></a>AnnotationMetadata</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// org.springframework.context.annotation.AutoProxyRegistrar</span></div><div class="line">Set&lt;String&gt; annoTypes = importingClassMetadata.getAnnotationTypes();</div><div class="line"><span class="keyword">for</span> (String annoType : annoTypes) &#123;</div><div class="line">    AnnotationAttributes candidate = MetadataUtils.attributesFor(importingClassMetadata, annoType);</div><div class="line">    Object mode = candidate.get(<span class="string">"mode"</span>);</div><div class="line">    Object proxyTargetClass = candidate.get(<span class="string">"proxyTargetClass"</span>);</div><div class="line">    <span class="keyword">if</span> (mode != <span class="keyword">null</span> &amp;&amp; proxyTargetClass != <span class="keyword">null</span> &amp;&amp; mode.getClass().equals(AdviceMode.class) &amp;&amp;</div><div class="line">            proxyTargetClass.getClass().equals(Boolean.class)) &#123;</div><div class="line">        candidateFound = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span> (mode == AdviceMode.PROXY) &#123;</div><div class="line">            AopConfigUtils.registerAutoProxyCreatorIfNecessary(registry);</div><div class="line">            <span class="keyword">if</span> ((Boolean) proxyTargetClass) &#123;</div><div class="line">                AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(registry);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="StandardAnnotationMetadata"><a href="#StandardAnnotationMetadata" class="headerlink" title="StandardAnnotationMetadata"></a>StandardAnnotationMetadata</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// org.springframework.beans.factory.annotation.AnnotatedGenericBeanDefinition</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> AnnotationMetadata metadata;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Create a new AnnotatedGenericBeanDefinition for the given bean class.</div><div class="line"> * <span class="doctag">@param</span> beanClass the loaded bean class</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">AnnotatedGenericBeanDefinition</span><span class="params">(Class&lt;?&gt; beanClass)</span> </span>&#123;</div><div class="line">    setBeanClass(beanClass);</div><div class="line">    <span class="keyword">this</span>.metadata = <span class="keyword">new</span> StandardAnnotationMetadata(beanClass, <span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="org-springframework-context-annotation-MetadataUtils"><a href="#org-springframework-context-annotation-MetadataUtils" class="headerlink" title="org.springframework.context.annotation.MetadataUtils"></a>org.springframework.context.annotation.MetadataUtils</h2><h1 id="Spring-Events"><a href="#Spring-Events" class="headerlink" title="Spring Events"></a>Spring Events</h1><p><code>事件</code></p>
<h2 id="Spring事件"><a href="#Spring事件" class="headerlink" title="Spring事件"></a>Spring事件</h2><p><code>Standard Events</code></p>
<blockquote><footer><strong>StandardEvents context-functionality-events.png</strong></footer></blockquote>
<blockquote><footer><strong>图片来源</strong><cite><a href="https://docs.spring.io/spring/docs/4.3.12.RELEASE/spring-framework-reference/htmlsingle/#context-functionality-events" target="_blank" rel="external">context-functionality-events</a></cite></footer></blockquote>
<ul>
<li>ContextRefreshedEvent </li>
<li>ContextClosedEvent</li>
<li>ContextStartedEvent</li>
<li>ContextStoppedEvent</li>
</ul>
<blockquote>
<p>if you want to get ContextStartedEvent, you should call start() on ApplicationContext.<br>LifecycleProcessor().onRefresh() trigger before ContextRefreshedEvent， both before <code>init</code> beans<br>LifecycleProcessor().onClose() trigger after ContextClosedEvent, both before <code>destroy</code> beans</p>
</blockquote>
<h2 id="自定义事件"><a href="#自定义事件" class="headerlink" title="自定义事件"></a>自定义事件</h2><p>事件处理过程异常，线程会异常终止。</p>
<p>事件接收</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实现接口 ApplicationListener 或者 注入 ApplicationEventPublisher（springEventPublisher）</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationListener</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span>&gt; <span class="keyword">extends</span> <span class="title">EventListener</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(E event)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>发布事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获得 publisher</span></div><div class="line"><span class="comment">// 方式1：实现接口 ApplicationEventPublisherAware</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationEventPublisherAware</span> <span class="keyword">extends</span> <span class="title">Aware</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 方式2：注入</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEventPublisher</span> </span>&#123;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ApplicationEventPublisher publisher;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doStuffAndPublishAnEvent</span><span class="params">(<span class="keyword">final</span> String message)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Publishing custom event."</span>);</div><div class="line">        CustomSpringEvent customSpringEvent = <span class="keyword">new</span> CustomSpringEvent(<span class="keyword">this</span>, message);</div><div class="line">        publisher.publishEvent(customSpringEvent);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>applicationEventPublisher在afterPropertiesSet之前已初始化完成</p>
</blockquote>
<p>异步处理（默认同步synchronous）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 异步处理 Asynchronous Events</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsynchronousSpringEventsConfig</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span>(name = <span class="string">"applicationEventMulticaster"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ApplicationEventMulticaster <span class="title">applicationEventMulticaster</span><span class="params">()</span> </span>&#123;</div><div class="line">        SimpleApplicationEventMulticaster eventMulticaster </div><div class="line">          = <span class="keyword">new</span> SimpleApplicationEventMulticaster();</div><div class="line">         </div><div class="line">        eventMulticaster.setTaskExecutor(<span class="keyword">new</span> SimpleAsyncTaskExecutor());</div><div class="line">        <span class="keyword">return</span> eventMulticaster;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ConcurrentTaskExecutor、ThreadPoolTaskExecutor、SimpleThreadPoolTaskExecutor</p>
</blockquote>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// TaskUtils#LOG_AND_SUPPRESS_ERROR_HANDLER</span></div><div class="line"><span class="comment">// TaskUtils.LoggingErrorHandler</span></div><div class="line"></div><div class="line"><span class="comment">// TaskUtils#LOG_AND_PROPAGATE_ERROR_HANDLER</span></div><div class="line"><span class="comment">// TaskUtils.PropagatingErrorHandler</span></div><div class="line"></div><div class="line"><span class="comment">// 异常处理 applicationEventMulticaster配置errorHandler</span></div><div class="line">eventMulticaster.setErrorHandler(TaskUtils.LOG_AND_SUPPRESS_ERROR_HANDLER);</div></pre></td></tr></table></figure>
<h3 id="事件注解"><a href="#事件注解" class="headerlink" title="事件注解"></a>事件注解</h3><p><code>As of Spring 4.2</code><br>Annotation-based Event Listeners</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EventListener</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processBlackListEvent</span><span class="params">(BlackListEvent event)</span> </span>&#123;</div><div class="line">    <span class="comment">// notify appropriate parties via notificationAddress...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 支持SpEL expression</span></div><div class="line"><span class="comment">// @EventListener(condition = "#blEvent.test == 'foo'")</span></div><div class="line"><span class="meta">@EventListener</span>(condition = <span class="string">"#creationEvent.awesome"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleOrderCreatedEvent</span><span class="params">(CreationEvent&lt;Order&gt; creationEvent)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Spring 4.2开始，ApplicationEventPublisher可以发送任意类型的对象</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// when said object isn’t an ApplicationEvent, we wrap it in a PayloadApplicationEvent for you. </div><div class="line">ApplicationEventPublisher#publishEvent(java.lang.Object)</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 接收普通对象事件</span></div><div class="line"><span class="comment">// 方式1 PayloadApplicationEvent&lt;T&gt;</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerApplicationListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">PayloadApplicationEvent</span>&lt;<span class="title">Integer</span>&gt;&gt; </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(PayloadApplicationEvent&lt;Integer&gt; event)</span> </span>&#123;</div><div class="line">        Integer payload = event.getPayload();</div><div class="line">        System.out.println(payload);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 方式2 注解</span></div><div class="line"><span class="comment">// 注解方式处理事件，可以有返回值，返回值将再次被发布</span></div><div class="line"><span class="comment">// org.springframework.context.event.ApplicationListenerMethodAdapter#processEvent</span></div><div class="line"><span class="comment">// If we return a non-null value from a method annotated with @EventListener as the result, Spring Framework will send that result as a new event for us.</span></div><div class="line"><span class="meta">@EventListener</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processBlackListEvent</span><span class="params">(Integer event)</span> </span>&#123;</div><div class="line">    System.out.println(event);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="SmartApplicationListener-amp-GenericApplicationListener"><a href="#SmartApplicationListener-amp-GenericApplicationListener" class="headerlink" title="SmartApplicationListener &amp; GenericApplicationListener"></a>SmartApplicationListener &amp; GenericApplicationListener</h2><p>SmartApplicationListener <code>Spring 3.0+</code><br>GenericApplicationListener <code>Spring 4.2+</code></p>
<p>扩展ApplicationListener，支持按eventType 和 sourceType 定义事件监听<br>其中 PayloadApplicationEvent source为ApplicationContext</p>
<h3 id="Transaction-bound-event"><a href="#Transaction-bound-event" class="headerlink" title="Transaction bound event"></a>Transaction bound event</h3><p>As of Spring <code>4.2</code>, the listener of an event can be bound to a phase of the transaction.</p>
<p><code>TransactionSynchronizationEventAdapter</code></p>
<p>在事务中发布事件，实际事件触发hook到事务的不同阶段【可多次触发】</p>
<ul>
<li>BEFORE_COMMIT</li>
<li>AFTER_COMMIT(default)</li>
<li>AFTER_ROLLBACK</li>
<li>AFTER_COMPLETION (an alias for AFTER_COMMIT and AFTER_ROLLBACK)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 发布事件</span></div><div class="line"><span class="meta">@Transactional</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">(Order order)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.publisher.publishEvent(<span class="keyword">new</span> OrderCreatedEvent(order)); </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 处理事件</span></div><div class="line"><span class="meta">@TransactionalEventListener</span>(phase = TransactionPhase.AFTER_COMMIT, condition = <span class="string">"#creationEvent.awesome"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleOrderCreatedEvent</span><span class="params">(CreationEvent&lt;Order&gt; creationEvent)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a href="https://spring.io/blog/2015/02/11/better-application-events-in-spring-framework-4-2" title="EclipseLink" target="_blank" rel="external">EclipseLink</a>
<a href="https://www.baeldung.com/spring-events" title="Spring Events" target="_blank" rel="external">Spring Events</a>
<h2 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h2><p><code>[&#39;laɪfˌsaɪkl]</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lifecycle</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRunning</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Lifecycle Bean 按Phased分组</span></div><div class="line"><span class="comment">// start时，按升序</span></div><div class="line"><span class="comment">// stop时，按降序</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Phased</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPhase</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Lifecycle Bean 在ApplicationContext finishRefresh时，不会启动；</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SmartLifecycle</span> <span class="keyword">extends</span> <span class="title">Lifecycle</span>, <span class="title">Phased</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAutoStartup</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">(Runnable callback)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>SmartLifecycle bean stop()不会被调用DefaultLifecycleProcessor#doStop</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- SmartLifecycle beans stop 超时时间 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"lifecycleProcessor"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.DefaultLifecycleProcessor"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- timeout value in milliseconds --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeoutPerShutdownPhase"</span> <span class="attr">value</span>=<span class="string">"10000"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String[] dependentBeans = <span class="keyword">this</span>.beanFactory.getDependentBeans(beanName);</div></pre></td></tr></table></figure>
<h1 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown"></a>shutdown</h1><ul>
<li>close() Close this application context, destroying all beans in its bean factory.</li>
<li>registerShutdownHook() – Register a shutdown hook with the JVM runtime, closing this context on JVM shutdown unless it has already been closed at that time.</li>
</ul>
<blockquote>
<p>Spring web shutdown</p>
</blockquote>
<h1 id="mistakes"><a href="#mistakes" class="headerlink" title="mistakes"></a>mistakes</h1><h2 id="xml中占位符解析失败"><a href="#xml中占位符解析失败" class="headerlink" title="xml中占位符解析失败"></a>xml中占位符解析失败</h2><p>properties已经配置，bean加载解析placeholder失败</p>
<blockquote>
<p>properties 重复加载</p>
</blockquote>
<h1 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions"></a>Solutions</h1><h2 id="org-aspectj-apache-bcel-classfile-ClassFormatException-Invalid-byte-tag-in-constant-pool-15"><a href="#org-aspectj-apache-bcel-classfile-ClassFormatException-Invalid-byte-tag-in-constant-pool-15" class="headerlink" title="org.aspectj.apache.bcel.classfile.ClassFormatException: Invalid byte tag in constant pool: 15"></a>org.aspectj.apache.bcel.classfile.ClassFormatException: Invalid byte tag in constant pool: 15</h2><p>项目中声明String类型的Bean，Spring启动报错</p>
<ol>
<li>项目使用注解切面，ump的@JProfiler</li>
<li>jdk 使用jdk8</li>
<li>org.aspectj:aspectjweaver:1.6.12</li>
</ol>
<p>Spring 启动时会检查所有Bean的所有方法，是否注解@JProfiler<br>这时会解析String类，aspectjweaver解析jdk8中的String类会报错org.aspectj.apache.bcel.classfile.ClassFormatException: Invalid byte tag in constant pool: 15</p>
<p>因为jdk8 引入了aspectjweaver1.6.12 不识别的结构体<a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.4.8" target="_blank" rel="external">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.4.8</a><br>报错位置org.aspectj.apache.bcel.classfile.Constant#readConstant</p>
<p>升级aspectjweaver到1.8.10可以解决； 或者不使用String类型Bean</p>
<h2 id="手动注入"><a href="#手动注入" class="headerlink" title="手动注入"></a>手动注入</h2><p><code>How to inject dependencies into a self-instantiated object in Spring?</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 手动创建的对象，注入Spring依赖</span></div><div class="line"><span class="comment">// 创建任务并由线程池执行</span></div><div class="line">TraceCompareTask traceCompareTask = <span class="keyword">new</span> TraceCompareTask(taskInfo);</div><div class="line">applicationContext.getBeanFactory().autowireBean(traceCompareTask);</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/14/spring-boot/" rel="next" title="Spring Boot">
                <i class="fa fa-chevron-left"></i> Spring Boot
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/02/java-junit/" rel="prev" title="java-junit">
                java-junit <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="xiaozhuang" />
          <p class="site-author-name" itemprop="name">xiaozhuang</p>
          <p class="site-description motion-element" itemprop="description">O ever youthful</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-MVC"><span class="nav-number">1.</span> <span class="nav-text">Spring MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Response"><span class="nav-number">1.1.</span> <span class="nav-text">Response</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#default-servlet-handler"><span class="nav-number">1.2.</span> <span class="nav-text">default-servlet-handler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DispatcherServlet"><span class="nav-number">1.3.</span> <span class="nav-text">DispatcherServlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reponse-application-json"><span class="nav-number">1.4.</span> <span class="nav-text">Reponse application/json</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ModelAttribute"><span class="nav-number">1.5.</span> <span class="nav-text">ModelAttribute</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方法使用-ModelAttribute标注"><span class="nav-number">1.5.1.</span> <span class="nav-text">方法使用@ModelAttribute标注</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法参数使用-ModelAttribute标注"><span class="nav-number">1.5.2.</span> <span class="nav-text">方法参数使用@ModelAttribute标注</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Controller"><span class="nav-number">2.</span> <span class="nav-text">Controller</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#获取User-Agent"><span class="nav-number">2.1.</span> <span class="nav-text">获取User-Agent</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AOP"><span class="nav-number">3.</span> <span class="nav-text">AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#切面顺序"><span class="nav-number">3.1.</span> <span class="nav-text">切面顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOP-Solutions"><span class="nav-number">3.2.</span> <span class="nav-text">AOP Solutions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义AOP-注解-在同一个类中的方法级别调用导致aop注解失效"><span class="nav-number">3.2.1.</span> <span class="nav-text">自定义AOP 注解 在同一个类中的方法级别调用导致aop注解失效</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自注入"><span class="nav-number">3.2.2.</span> <span class="nav-text">自注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AutoProxyCreator"><span class="nav-number">3.2.3.</span> <span class="nav-text">AutoProxyCreator</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注入多个相同类型Bean"><span class="nav-number">3.3.</span> <span class="nav-text">注入多个相同类型Bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#onAround返回类型为void"><span class="nav-number">3.4.</span> <span class="nav-text">onAround返回类型为void</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ProxyFactoryBean"><span class="nav-number">3.5.</span> <span class="nav-text">ProxyFactoryBean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOP-通知类型"><span class="nav-number">3.6.</span> <span class="nav-text">AOP 通知类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#环绕通知（Around）"><span class="nav-number">3.6.1.</span> <span class="nav-text">环绕通知（Around）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前置通知（Before）"><span class="nav-number">3.6.2.</span> <span class="nav-text">前置通知（Before）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后置通知（After）"><span class="nav-number">3.6.3.</span> <span class="nav-text">后置通知（After）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回通知（After-returning）"><span class="nav-number">3.6.4.</span> <span class="nav-text">返回通知（After-returning）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常通知（After-throwing）"><span class="nav-number">3.6.5.</span> <span class="nav-text">异常通知（After-throwing）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AspectJ-表达式"><span class="nav-number">3.7.</span> <span class="nav-text">AspectJ 表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#execution"><span class="nav-number">3.7.1.</span> <span class="nav-text">execution()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#annotation"><span class="nav-number">3.7.2.</span> <span class="nav-text">@annotation()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this"><span class="nav-number">3.7.3.</span> <span class="nav-text">this()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#within"><span class="nav-number">3.7.4.</span> <span class="nav-text">within()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#within-1"><span class="nav-number">3.7.5.</span> <span class="nav-text">@within()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#target"><span class="nav-number">3.7.6.</span> <span class="nav-text">target()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#target-1"><span class="nav-number">3.7.7.</span> <span class="nav-text">@target()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#args"><span class="nav-number">3.7.8.</span> <span class="nav-text">args()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#args-1"><span class="nav-number">3.7.9.</span> <span class="nav-text">@args()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bean"><span class="nav-number">3.7.10.</span> <span class="nav-text">bean()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reference-pointcut"><span class="nav-number">3.7.11.</span> <span class="nav-text">reference pointcut</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#引介增强"><span class="nav-number">3.8.</span> <span class="nav-text">引介增强</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境变量"><span class="nav-number">4.</span> <span class="nav-text">环境变量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Java读取环境变量"><span class="nav-number">4.1.</span> <span class="nav-text">Java读取环境变量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tips"><span class="nav-number">5.</span> <span class="nav-text">Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#最好不要配置xsd文件的版本号"><span class="nav-number">5.1.</span> <span class="nav-text">最好不要配置xsd文件的版本号</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#自定义xml标签"><span class="nav-number">6.</span> <span class="nav-text">自定义xml标签</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置NamespaceHandler"><span class="nav-number">6.1.</span> <span class="nav-text">配置NamespaceHandler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义NamespaceHandler"><span class="nav-number">6.2.</span> <span class="nav-text">定义NamespaceHandler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BeanDefinitionParser"><span class="nav-number">6.3.</span> <span class="nav-text">BeanDefinitionParser</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置schemas-xsd"><span class="nav-number">6.4.</span> <span class="nav-text">配置schemas xsd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注意事项"><span class="nav-number">6.5.</span> <span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tools"><span class="nav-number">7.</span> <span class="nav-text">Tools</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SerializationUtils"><span class="nav-number">7.1.</span> <span class="nav-text">SerializationUtils</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串"><span class="nav-number">7.2.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类加载"><span class="nav-number">7.3.</span> <span class="nav-text">类加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ThreadLocal"><span class="nav-number">7.4.</span> <span class="nav-text">ThreadLocal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#反射"><span class="nav-number">7.5.</span> <span class="nav-text">反射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注解读取"><span class="nav-number">7.6.</span> <span class="nav-text">注解读取</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置加载-properties、xml"><span class="nav-number">8.</span> <span class="nav-text">配置加载 properties、xml</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用Environment"><span class="nav-number">8.1.</span> <span class="nav-text">使用Environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PropertySource"><span class="nav-number">8.2.</span> <span class="nav-text">PropertySource</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用SpEL表达式"><span class="nav-number">8.3.</span> <span class="nav-text">使用SpEL表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过Properties实体"><span class="nav-number">8.4.</span> <span class="nav-text">通过Properties实体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置注入"><span class="nav-number">8.5.</span> <span class="nav-text">配置注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-PropertiesFactoryBean"><span class="nav-number">8.6.</span> <span class="nav-text">使用 PropertiesFactoryBean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件读取"><span class="nav-number">8.7.</span> <span class="nav-text">文件读取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#import"><span class="nav-number">8.8.</span> <span class="nav-text">import</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拷贝注解至Bean"><span class="nav-number">8.9.</span> <span class="nav-text">拷贝注解至Bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#断言"><span class="nav-number">8.10.</span> <span class="nav-text">断言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xml解析"><span class="nav-number">8.11.</span> <span class="nav-text">xml解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取原始类"><span class="nav-number">8.12.</span> <span class="nav-text">获取原始类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合并map"><span class="nav-number">8.13.</span> <span class="nav-text">合并map</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工厂方法创建bean"><span class="nav-number">8.14.</span> <span class="nav-text">工厂方法创建bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#静态字段创建bean"><span class="nav-number">8.15.</span> <span class="nav-text">静态字段创建bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ResolvableType"><span class="nav-number">8.16.</span> <span class="nav-text">ResolvableType</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#排序"><span class="nav-number">8.17.</span> <span class="nav-text">排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Object类型转换"><span class="nav-number">8.18.</span> <span class="nav-text">Object类型转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AnnotatedTypeMetadata"><span class="nav-number">8.19.</span> <span class="nav-text">AnnotatedTypeMetadata</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MultiValueMap"><span class="nav-number">8.20.</span> <span class="nav-text">MultiValueMap</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-常识"><span class="nav-number">9.</span> <span class="nav-text">Spring 常识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#获取全部bean"><span class="nav-number">9.1.</span> <span class="nav-text">获取全部bean</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringMVC"><span class="nav-number">10.</span> <span class="nav-text">SpringMVC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#解决Long转json精度丢失的问题"><span class="nav-number">10.1.</span> <span class="nav-text">解决Long转json精度丢失的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#请求空串转为null"><span class="nav-number">10.2.</span> <span class="nav-text">请求空串转为null</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Response-1"><span class="nav-number">10.3.</span> <span class="nav-text">Response</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取request"><span class="nav-number">10.4.</span> <span class="nav-text">获取request</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringMVC-Annotation"><span class="nav-number">10.5.</span> <span class="nav-text">SpringMVC Annotation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringMVC-Solutions"><span class="nav-number">10.6.</span> <span class="nav-text">SpringMVC Solutions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-creating-bean-with-name-‘org-springframework-validation-beanvalidation-LocalValidatorFactoryBean-0’"><span class="nav-number">10.6.1.</span> <span class="nav-text">Error creating bean with name ‘org.springframework.validation.beanvalidation.LocalValidatorFactoryBean#0’</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-IOC"><span class="nav-number">11.</span> <span class="nav-text">Spring IOC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Aware"><span class="nav-number">11.1.</span> <span class="nav-text">Aware</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#父子容器"><span class="nav-number">11.2.</span> <span class="nav-text">父子容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#重复AOP"><span class="nav-number">11.2.1.</span> <span class="nav-text">重复AOP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BeanFactory和ApplicationContext"><span class="nav-number">11.3.</span> <span class="nav-text">BeanFactory和ApplicationContext</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebApplicationContext"><span class="nav-number">11.4.</span> <span class="nav-text">WebApplicationContext</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bean命名"><span class="nav-number">11.5.</span> <span class="nav-text">Bean命名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工厂方法"><span class="nav-number">11.6.</span> <span class="nav-text">工厂方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态注册Bean"><span class="nav-number">11.7.</span> <span class="nav-text">动态注册Bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖注入"><span class="nav-number">11.8.</span> <span class="nav-text">依赖注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置"><span class="nav-number">11.8.1.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自动注入"><span class="nav-number">11.8.2.</span> <span class="nav-text">自动注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bean维度取消自动注入"><span class="nav-number">11.8.3.</span> <span class="nav-text">Bean维度取消自动注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xml注入map"><span class="nav-number">11.8.4.</span> <span class="nav-text">xml注入map</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构造器注入"><span class="nav-number">11.8.5.</span> <span class="nav-text">构造器注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注入参数"><span class="nav-number">11.8.6.</span> <span class="nav-text">注入参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合类型属性"><span class="nav-number">11.8.7.</span> <span class="nav-text">集合类型属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过util命名空间配置集合类型Bean"><span class="nav-number">11.8.8.</span> <span class="nav-text">通过util命名空间配置集合类型Bean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#继承"><span class="nav-number">11.8.9.</span> <span class="nav-text">继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行时注入-属性占位符"><span class="nav-number">11.8.10.</span> <span class="nav-text">运行时注入-属性占位符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行时注入-Spring表达式语言-SpEL"><span class="nav-number">11.8.11.</span> <span class="nav-text">运行时注入-Spring表达式语言(SpEL)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bean作用域"><span class="nav-number">11.9.</span> <span class="nav-text">Bean作用域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#校验Bean成员变量是否设置"><span class="nav-number">11.10.</span> <span class="nav-text">校验Bean成员变量是否设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#meta元素"><span class="nav-number">11.11.</span> <span class="nav-text">meta元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lookup-method"><span class="nav-number">11.12.</span> <span class="nav-text">lookup-method</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#replaced-method"><span class="nav-number">11.13.</span> <span class="nav-text">replaced-method</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注入静态字段"><span class="nav-number">11.14.</span> <span class="nav-text">注入静态字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BeanFactory"><span class="nav-number">11.15.</span> <span class="nav-text">BeanFactory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DataSource"><span class="nav-number">11.16.</span> <span class="nav-text">DataSource</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Resource"><span class="nav-number">11.17.</span> <span class="nav-text">@Resource</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Autowired"><span class="nav-number">11.18.</span> <span class="nav-text">@Autowired</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Primary"><span class="nav-number">11.19.</span> <span class="nav-text">@Primary</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qualifier"><span class="nav-number">11.20.</span> <span class="nav-text">Qualifier</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Profile"><span class="nav-number">11.21.</span> <span class="nav-text">Profile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-Profiles"><span class="nav-number">11.21.1.</span> <span class="nav-text">Set Profiles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Get-Active-Profiles"><span class="nav-number">11.21.2.</span> <span class="nav-text">Get Active Profiles</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#条件化配置"><span class="nav-number">11.22.</span> <span class="nav-text">条件化配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取bean"><span class="nav-number">11.23.</span> <span class="nav-text">获取bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#别名"><span class="nav-number">11.24.</span> <span class="nav-text">别名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scope"><span class="nav-number">11.25.</span> <span class="nav-text">Scope</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BeanFactoryPostProcessor"><span class="nav-number">11.26.</span> <span class="nav-text">BeanFactoryPostProcessor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Role"><span class="nav-number">11.27.</span> <span class="nav-text">@Role</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AutoProxyRegistrar"><span class="nav-number">11.28.</span> <span class="nav-text">AutoProxyRegistrar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ImportBeanDefinitionRegistrar"><span class="nav-number">11.29.</span> <span class="nav-text">ImportBeanDefinitionRegistrar</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AnnotationMetadata"><span class="nav-number">12.</span> <span class="nav-text">AnnotationMetadata</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#StandardAnnotationMetadata"><span class="nav-number">12.1.</span> <span class="nav-text">StandardAnnotationMetadata</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#org-springframework-context-annotation-MetadataUtils"><span class="nav-number">12.2.</span> <span class="nav-text">org.springframework.context.annotation.MetadataUtils</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-Events"><span class="nav-number">13.</span> <span class="nav-text">Spring Events</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring事件"><span class="nav-number">13.1.</span> <span class="nav-text">Spring事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义事件"><span class="nav-number">13.2.</span> <span class="nav-text">自定义事件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#异常处理"><span class="nav-number">13.2.1.</span> <span class="nav-text">异常处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件注解"><span class="nav-number">13.2.2.</span> <span class="nav-text">事件注解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SmartApplicationListener-amp-GenericApplicationListener"><span class="nav-number">13.3.</span> <span class="nav-text">SmartApplicationListener & GenericApplicationListener</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Transaction-bound-event"><span class="nav-number">13.3.1.</span> <span class="nav-text">Transaction bound event</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lifecycle"><span class="nav-number">13.4.</span> <span class="nav-text">Lifecycle</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖"><span class="nav-number">13.5.</span> <span class="nav-text">依赖</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shutdown"><span class="nav-number">14.</span> <span class="nav-text">shutdown</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mistakes"><span class="nav-number">15.</span> <span class="nav-text">mistakes</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#xml中占位符解析失败"><span class="nav-number">15.1.</span> <span class="nav-text">xml中占位符解析失败</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Solutions"><span class="nav-number">16.</span> <span class="nav-text">Solutions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#org-aspectj-apache-bcel-classfile-ClassFormatException-Invalid-byte-tag-in-constant-pool-15"><span class="nav-number">16.1.</span> <span class="nav-text">org.aspectj.apache.bcel.classfile.ClassFormatException: Invalid byte tag in constant pool: 15</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#手动注入"><span class="nav-number">16.2.</span> <span class="nav-text">手动注入</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiaozhuang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




  
  
  
  <script type="text/javascript">
    $(document).ready(function () {
      if ( $('#local-search-input').size() === 0) {
        return;
      }

      // Popup Window;
      var isfetched = false;
      // Search DB path;
      var search_path = "search.xml";
      if (search_path.length == 0) {
        search_path = "search.xml";
      }
      var path = "/" + search_path;
      // monitor main search box;

      function proceedsearch() {
        $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
        $('.popup').toggle();

      }
      // search function;
      var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
          url: path,
          dataType: "xml",
          async: true,
          success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
              return {
                title: $( "title", this ).text(),
                content: $("content",this).text(),
                url: $( "url" , this).text()
              };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
              var matchcounts = 0;
              var str='<ul class=\"search-result-list\">';
              var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
              $resultContent.innerHTML = "";
              if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                  var isMatch = true;
                  var content_index = [];
                  var data_title = data.title.trim().toLowerCase();
                  var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                  var data_url = data.url;
                  var index_title = -1;
                  var index_content = -1;
                  var first_occur = -1;
                  // only match artiles with not empty titles and contents
                  if(data_title != '' && data_content != '') {
                    keywords.forEach(function(keyword, i) {
                      index_title = data_title.indexOf(keyword);
                      index_content = data_content.indexOf(keyword);
                      if( index_title < 0 && index_content < 0 ){
                        isMatch = false;
                      } else {
                        if (index_content < 0) {
                          index_content = 0;
                        }
                        if (i == 0) {
                          first_occur = index_content;
                        }
                      }
                    });
                  }
                  // show search results
                  if (isMatch) {
                    matchcounts += 1;
                    str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                    var content = data.content.trim().replace(/<[^>]+>/g,"");
                    if (first_occur >= 0) {
                      // cut out 100 characters
                      var start = first_occur - 20;
                      var end = first_occur + 80;
                      if(start < 0){
                        start = 0;
                      }
                      if(start == 0){
                        end = 50;
                      }
                      if(end > content.length){
                        end = content.length;
                      }
                      var match_content = content.substring(start, end);
                      // highlight all keywords
                      keywords.forEach(function(keyword){
                        var regS = new RegExp(keyword, "gi");
                        match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                      });

                      str += "<p class=\"search-result\">" + match_content +"...</p>"
                    }
                    str += "</li>";
                  }
                })};
              str += "</ul>";
              if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
              if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
              $resultContent.innerHTML = str;
            });
            proceedsearch();
          }
        });}

      // handle and trigger popup window;
      $('.popup-trigger').mousedown(function(e) {
        e.stopPropagation();
        if (isfetched == false) {
          searchFunc(path, 'local-search-input', 'local-search-result');
        } else {
          proceedsearch();
        };

      });

      $('.popup-btn-close').click(function(e){
        $('.popup').hide();
        $(".popoverlay").remove();
        $('body').css('overflow', '');
      });
      $('.popup').click(function(e){
        e.stopPropagation();
      });
    });
  </script>


  

  

  
  


</body>
</html>
